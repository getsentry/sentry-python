<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>sentry_sdk.scope - sentry-python 2.40.0 documentation</title><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b1a1f93b" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=bb284d7b" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="sentry_sdk.scope"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../index.html">
      
      
      <strong>sentry-python</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/getsentry/sentry-python" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Top Level API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidocs.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">sentry-python</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">sentry_sdk.scope</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for sentry_sdk.scope</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>
</span><span data-line="6"><span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>
</span><span data-line="7"><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
</span><span data-line="8"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="9"><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>
</span><span data-line="10"><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">chain</span>
</span><span data-line="11">
</span><span data-line="12"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk._types</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnnotatedValue</span>
</span><span data-line="13"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.attachments</span><span class="w"> </span><span class="kn">import</span> <span class="n">Attachment</span>
</span><span data-line="14"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.consts</span><span class="w"> </span><span class="kn">import</span> <span class="n">DEFAULT_MAX_BREADCRUMBS</span><span class="p">,</span> <span class="n">FALSE_VALUES</span><span class="p">,</span> <span class="n">INSTRUMENTER</span>
</span><span data-line="15"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.feature_flags</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlagBuffer</span><span class="p">,</span> <span class="n">DEFAULT_FLAG_CAPACITY</span>
</span><span data-line="16"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.profiler.continuous_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="17">    <span class="n">get_profiler_id</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">try_autostart_continuous_profiler</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">try_profile_lifecycle_trace_start</span><span class="p">,</span>
</span><span data-line="20"><span class="p">)</span>
</span><span data-line="21"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.profiler.transaction_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">Profile</span>
</span><span data-line="22"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.session</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>
</span><span data-line="23"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.tracing_utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="24">    <span class="n">Baggage</span><span class="p">,</span>
</span><span data-line="25">    <span class="n">has_tracing_enabled</span><span class="p">,</span>
</span><span data-line="26">    <span class="n">normalize_incoming_data</span><span class="p">,</span>
</span><span data-line="27">    <span class="n">PropagationContext</span><span class="p">,</span>
</span><span data-line="28"><span class="p">)</span>
</span><span data-line="29"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.tracing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="30">    <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span>
</span><span data-line="31">    <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span>
</span><span data-line="32">    <span class="n">NoOpSpan</span><span class="p">,</span>
</span><span data-line="33">    <span class="n">Span</span><span class="p">,</span>
</span><span data-line="34">    <span class="n">Transaction</span><span class="p">,</span>
</span><span data-line="35"><span class="p">)</span>
</span><span data-line="36"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="37">    <span class="n">capture_internal_exception</span><span class="p">,</span>
</span><span data-line="38">    <span class="n">capture_internal_exceptions</span><span class="p">,</span>
</span><span data-line="39">    <span class="n">ContextVar</span><span class="p">,</span>
</span><span data-line="40">    <span class="n">datetime_from_isoformat</span><span class="p">,</span>
</span><span data-line="41">    <span class="n">disable_capture_event</span><span class="p">,</span>
</span><span data-line="42">    <span class="n">event_from_exception</span><span class="p">,</span>
</span><span data-line="43">    <span class="n">exc_info_from_error</span><span class="p">,</span>
</span><span data-line="44">    <span class="n">logger</span><span class="p">,</span>
</span><span data-line="45"><span class="p">)</span>
</span><span data-line="46">
</span><span data-line="47"><span class="kn">import</span><span class="w"> </span><span class="nn">typing</span>
</span><span data-line="48"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span data-line="49">
</span><span data-line="50"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="51">    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapping</span>
</span><span data-line="52">
</span><span data-line="53">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
</span><span data-line="54">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
</span><span data-line="55">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Deque</span>
</span><span data-line="56">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span>
</span><span data-line="57">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Generator</span>
</span><span data-line="58">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterator</span>
</span><span data-line="59">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
</span><span data-line="60">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
</span><span data-line="61">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParamSpec</span>
</span><span data-line="62">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>
</span><span data-line="63">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span>
</span><span data-line="64">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>
</span><span data-line="65">
</span><span data-line="66">    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Unpack</span>
</span><span data-line="67">
</span><span data-line="68">    <span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk._types</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="69">        <span class="n">Breadcrumb</span><span class="p">,</span>
</span><span data-line="70">        <span class="n">BreadcrumbHint</span><span class="p">,</span>
</span><span data-line="71">        <span class="n">ErrorProcessor</span><span class="p">,</span>
</span><span data-line="72">        <span class="n">Event</span><span class="p">,</span>
</span><span data-line="73">        <span class="n">EventProcessor</span><span class="p">,</span>
</span><span data-line="74">        <span class="n">ExcInfo</span><span class="p">,</span>
</span><span data-line="75">        <span class="n">Hint</span><span class="p">,</span>
</span><span data-line="76">        <span class="n">LogLevelStr</span><span class="p">,</span>
</span><span data-line="77">        <span class="n">SamplingContext</span><span class="p">,</span>
</span><span data-line="78">        <span class="n">Type</span><span class="p">,</span>
</span><span data-line="79">    <span class="p">)</span>
</span><span data-line="80">
</span><span data-line="81">    <span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.tracing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TransactionKwargs</span>
</span><span data-line="82">
</span><span data-line="83">    <span class="kn">import</span><span class="w"> </span><span class="nn">sentry_sdk</span>
</span><span data-line="84">
</span><span data-line="85">    <span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span data-line="86">    <span class="n">R</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
</span><span data-line="87">
</span><span data-line="88">    <span class="n">F</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>
</span><span data-line="89">    <span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
</span><span data-line="90">
</span><span data-line="91">
</span><span data-line="92"><span class="c1"># Holds data that will be added to **all** events sent by this process.</span>
</span><span data-line="93"><span class="c1"># In case this is a http server (think web framework) with multiple users</span>
</span><span data-line="94"><span class="c1"># the data will be added to events of all users.</span>
</span><span data-line="95"><span class="c1"># Typically this is used for process wide data such as the release.</span>
</span><span data-line="96"><span class="n">_global_scope</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Scope]</span>
</span><span data-line="97">
</span><span data-line="98"><span class="c1"># Holds data for the active request.</span>
</span><span data-line="99"><span class="c1"># This is used to isolate data for different requests or users.</span>
</span><span data-line="100"><span class="c1"># The isolation scope is usually created by integrations, but may also</span>
</span><span data-line="101"><span class="c1"># be created manually</span>
</span><span data-line="102"><span class="n">_isolation_scope</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;isolation_scope&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span data-line="103">
</span><span data-line="104"><span class="c1"># Holds data for the active span.</span>
</span><span data-line="105"><span class="c1"># This can be used to manually add additional data to a span.</span>
</span><span data-line="106"><span class="n">_current_scope</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;current_scope&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span data-line="107">
</span><span data-line="108"><span class="n">global_event_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[EventProcessor]</span>
</span><span data-line="109">
</span><span data-line="110">
</span><span data-line="111"><span class="k">class</span><span class="w"> </span><span class="nc">ScopeType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span data-line="112">    <span class="n">CURRENT</span> <span class="o">=</span> <span class="s2">&quot;current&quot;</span>
</span><span data-line="113">    <span class="n">ISOLATION</span> <span class="o">=</span> <span class="s2">&quot;isolation&quot;</span>
</span><span data-line="114">    <span class="n">GLOBAL</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
</span><span data-line="115">    <span class="n">MERGED</span> <span class="o">=</span> <span class="s2">&quot;merged&quot;</span>
</span><span data-line="116">
</span><span data-line="117">
</span><span data-line="118"><span class="k">class</span><span class="w"> </span><span class="nc">_ScopeManager</span><span class="p">:</span>
</span><span data-line="119">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hub</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="120">        <span class="c1"># type: (Optional[Any]) -&gt; None</span>
</span><span data-line="121">        <span class="bp">self</span><span class="o">.</span><span class="n">_old_scopes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Scope]</span>
</span><span data-line="122">
</span><span data-line="123">    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="124">        <span class="c1"># type: () -&gt; Scope</span>
</span><span data-line="125">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span>
</span><span data-line="126">
</span><span data-line="127">        <span class="bp">self</span><span class="o">.</span><span class="n">_old_scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">)</span>
</span><span data-line="128">
</span><span data-line="129">        <span class="n">forked_scope</span> <span class="o">=</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span data-line="130">        <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">forked_scope</span><span class="p">)</span>
</span><span data-line="131">
</span><span data-line="132">        <span class="k">return</span> <span class="n">forked_scope</span>
</span><span data-line="133">
</span><span data-line="134">    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
</span><span data-line="135">        <span class="c1"># type: (Any, Any, Any) -&gt; None</span>
</span><span data-line="136">        <span class="n">old_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_scopes</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span data-line="137">        <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">old_scope</span><span class="p">)</span>
</span><span data-line="138">
</span><span data-line="139">
</span><span data-line="140"><span class="k">def</span><span class="w"> </span><span class="nf">add_global_event_processor</span><span class="p">(</span><span class="n">processor</span><span class="p">):</span>
</span><span data-line="141">    <span class="c1"># type: (EventProcessor) -&gt; None</span>
</span><span data-line="142">    <span class="n">global_event_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
</span><span data-line="143">
</span><span data-line="144">
</span><span data-line="145"><span class="k">def</span><span class="w"> </span><span class="nf">_attr_setter</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span><span data-line="146">    <span class="c1"># type: (Any) -&gt; Any</span>
</span><span data-line="147">    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">fset</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span data-line="148">
</span><span data-line="149">
</span><span data-line="150"><span class="k">def</span><span class="w"> </span><span class="nf">_disable_capture</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span><span data-line="151">    <span class="c1"># type: (F) -&gt; F</span>
</span><span data-line="152">    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span data-line="153">    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="154">        <span class="c1"># type: (Any, *Dict[str, Any], **Any) -&gt; Any</span>
</span><span data-line="155">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span><span class="p">:</span>
</span><span data-line="156">            <span class="k">return</span>
</span><span data-line="157">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="158">            <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="159">            <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="160">        <span class="k">finally</span><span class="p">:</span>
</span><span data-line="161">            <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="162">
</span><span data-line="163">    <span class="k">return</span> <span class="n">wrapper</span>  <span class="c1"># type: ignore</span>
</span><span data-line="164">
</span><span data-line="165">
<div class="viewcode-block" id="Scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope">[docs]</a>
</span><span data-line="166"><span class="k">class</span><span class="w"> </span><span class="nc">Scope</span><span class="p">:</span>
</span><span data-line="167"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The scope holds extra information that should be sent with all</span>
</span><span data-line="168"><span class="sd">    events that belong to it.</span>
</span><span data-line="169"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="170">
</span><span data-line="171">    <span class="c1"># NOTE: Even though it should not happen, the scope needs to not crash when</span>
</span><span data-line="172">    <span class="c1"># accessed by multiple threads. It&#39;s fine if it&#39;s full of races, but those</span>
</span><span data-line="173">    <span class="c1"># races should never make the user application crash.</span>
</span><span data-line="174">    <span class="c1">#</span>
</span><span data-line="175">    <span class="c1"># The same needs to hold for any accesses of the scope the SDK makes.</span>
</span><span data-line="176">
</span><span data-line="177">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="178">        <span class="s2">&quot;_level&quot;</span><span class="p">,</span>
</span><span data-line="179">        <span class="s2">&quot;_name&quot;</span><span class="p">,</span>
</span><span data-line="180">        <span class="s2">&quot;_fingerprint&quot;</span><span class="p">,</span>
</span><span data-line="181">        <span class="c1"># note that for legacy reasons, _transaction is the transaction *name*,</span>
</span><span data-line="182">        <span class="c1"># not a Transaction object (the object is stored in _span)</span>
</span><span data-line="183">        <span class="s2">&quot;_transaction&quot;</span><span class="p">,</span>
</span><span data-line="184">        <span class="s2">&quot;_transaction_info&quot;</span><span class="p">,</span>
</span><span data-line="185">        <span class="s2">&quot;_user&quot;</span><span class="p">,</span>
</span><span data-line="186">        <span class="s2">&quot;_tags&quot;</span><span class="p">,</span>
</span><span data-line="187">        <span class="s2">&quot;_contexts&quot;</span><span class="p">,</span>
</span><span data-line="188">        <span class="s2">&quot;_extras&quot;</span><span class="p">,</span>
</span><span data-line="189">        <span class="s2">&quot;_breadcrumbs&quot;</span><span class="p">,</span>
</span><span data-line="190">        <span class="s2">&quot;_n_breadcrumbs_truncated&quot;</span><span class="p">,</span>
</span><span data-line="191">        <span class="s2">&quot;_event_processors&quot;</span><span class="p">,</span>
</span><span data-line="192">        <span class="s2">&quot;_error_processors&quot;</span><span class="p">,</span>
</span><span data-line="193">        <span class="s2">&quot;_should_capture&quot;</span><span class="p">,</span>
</span><span data-line="194">        <span class="s2">&quot;_span&quot;</span><span class="p">,</span>
</span><span data-line="195">        <span class="s2">&quot;_session&quot;</span><span class="p">,</span>
</span><span data-line="196">        <span class="s2">&quot;_attachments&quot;</span><span class="p">,</span>
</span><span data-line="197">        <span class="s2">&quot;_force_auto_session_tracking&quot;</span><span class="p">,</span>
</span><span data-line="198">        <span class="s2">&quot;_profile&quot;</span><span class="p">,</span>
</span><span data-line="199">        <span class="s2">&quot;_propagation_context&quot;</span><span class="p">,</span>
</span><span data-line="200">        <span class="s2">&quot;client&quot;</span><span class="p">,</span>
</span><span data-line="201">        <span class="s2">&quot;_type&quot;</span><span class="p">,</span>
</span><span data-line="202">        <span class="s2">&quot;_last_event_id&quot;</span><span class="p">,</span>
</span><span data-line="203">        <span class="s2">&quot;_flags&quot;</span><span class="p">,</span>
</span><span data-line="204">    <span class="p">)</span>
</span><span data-line="205">
</span><span data-line="206">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="207">        <span class="c1"># type: (Optional[ScopeType], Optional[sentry_sdk.Client]) -&gt; None</span>
</span><span data-line="208">        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">ty</span>
</span><span data-line="209">
</span><span data-line="210">        <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[EventProcessor]</span>
</span><span data-line="211">        <span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[ErrorProcessor]</span>
</span><span data-line="212">
</span><span data-line="213">        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
</span><span data-line="214">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[PropagationContext]</span>
</span><span data-line="215">        <span class="bp">self</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># type: int</span>
</span><span data-line="216">
</span><span data-line="217">        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">NonRecordingClient</span><span class="p">()</span>  <span class="c1"># type: sentry_sdk.client.BaseClient</span>
</span><span data-line="218">
</span><span data-line="219">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="220">            <span class="bp">self</span><span class="o">.</span><span class="n">set_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</span><span data-line="221">
</span><span data-line="222">        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span data-line="223">
</span><span data-line="224">        <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_trace_data_from_env</span><span class="p">()</span>
</span><span data-line="225">        <span class="bp">self</span><span class="o">.</span><span class="n">generate_propagation_context</span><span class="p">(</span><span class="n">incoming_data</span><span class="o">=</span><span class="n">incoming_trace_information</span><span class="p">)</span>
</span><span data-line="226">
</span><span data-line="227">    <span class="k">def</span><span class="w"> </span><span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="228">        <span class="c1"># type: () -&gt; Scope</span>
</span><span data-line="229"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="230"><span class="sd">        Returns a copy of this scope.</span>
</span><span data-line="231"><span class="sd">        This also creates a copy of all referenced data structures.</span>
</span><span data-line="232"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="233">        <span class="n">rv</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>  <span class="c1"># type: Scope</span>
</span><span data-line="234">
</span><span data-line="235">        <span class="n">rv</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>
</span><span data-line="236">        <span class="n">rv</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span>
</span><span data-line="237">        <span class="n">rv</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
</span><span data-line="238">        <span class="n">rv</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span data-line="239">        <span class="n">rv</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span data-line="240">        <span class="n">rv</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span>
</span><span data-line="241">        <span class="n">rv</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="242">        <span class="n">rv</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span>
</span><span data-line="243">
</span><span data-line="244">        <span class="n">rv</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="245">        <span class="n">rv</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="246">        <span class="n">rv</span><span class="o">.</span><span class="n">_extras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="247">
</span><span data-line="248">        <span class="n">rv</span><span class="o">.</span><span class="n">_breadcrumbs</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span>
</span><span data-line="249">        <span class="n">rv</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span>
</span><span data-line="250">        <span class="n">rv</span><span class="o">.</span><span class="n">_event_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="251">        <span class="n">rv</span><span class="o">.</span><span class="n">_error_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="252">        <span class="n">rv</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span data-line="253">
</span><span data-line="254">        <span class="n">rv</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span>
</span><span data-line="255">        <span class="n">rv</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span>
</span><span data-line="256">        <span class="n">rv</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
</span><span data-line="257">        <span class="n">rv</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span>
</span><span data-line="258">        <span class="n">rv</span><span class="o">.</span><span class="n">_attachments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="259">
</span><span data-line="260">        <span class="n">rv</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>
</span><span data-line="261">
</span><span data-line="262">        <span class="n">rv</span><span class="o">.</span><span class="n">_last_event_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_event_id</span>
</span><span data-line="263">
</span><span data-line="264">        <span class="n">rv</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
</span><span data-line="265">
</span><span data-line="266">        <span class="k">return</span> <span class="n">rv</span>
</span><span data-line="267">
<div class="viewcode-block" id="Scope.get_current_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_current_scope">[docs]</a>
</span><span data-line="268">    <span class="nd">@classmethod</span>
</span><span data-line="269">    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span data-line="270">        <span class="c1"># type: () -&gt; Scope</span>
</span><span data-line="271"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="272"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span data-line="273">
</span><span data-line="274"><span class="sd">        Returns the current scope.</span>
</span><span data-line="275"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="276">        <span class="n">current_scope</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="277">        <span class="k">if</span> <span class="n">current_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="278">            <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">(</span><span class="n">ty</span><span class="o">=</span><span class="n">ScopeType</span><span class="o">.</span><span class="n">CURRENT</span><span class="p">)</span>
</span><span data-line="279">            <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">current_scope</span><span class="p">)</span>
</span><span data-line="280">
</span><span data-line="281">        <span class="k">return</span> <span class="n">current_scope</span></div>

</span><span data-line="282">
<div class="viewcode-block" id="Scope.set_current_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_current_scope">[docs]</a>
</span><span data-line="283">    <span class="nd">@classmethod</span>
</span><span data-line="284">    <span class="k">def</span><span class="w"> </span><span class="nf">set_current_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_current_scope</span><span class="p">):</span>
</span><span data-line="285">        <span class="c1"># type: (Scope) -&gt; None</span>
</span><span data-line="286"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="287"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span data-line="288">
</span><span data-line="289"><span class="sd">        Sets the given scope as the new current scope overwriting the existing current scope.</span>
</span><span data-line="290"><span class="sd">        :param new_current_scope: The scope to set as the new current scope.</span>
</span><span data-line="291"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="292">        <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_current_scope</span><span class="p">)</span></div>

</span><span data-line="293">
<div class="viewcode-block" id="Scope.get_isolation_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_isolation_scope">[docs]</a>
</span><span data-line="294">    <span class="nd">@classmethod</span>
</span><span data-line="295">    <span class="k">def</span><span class="w"> </span><span class="nf">get_isolation_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span data-line="296">        <span class="c1"># type: () -&gt; Scope</span>
</span><span data-line="297"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="298"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span data-line="299">
</span><span data-line="300"><span class="sd">        Returns the isolation scope.</span>
</span><span data-line="301"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="302">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="303">        <span class="k">if</span> <span class="n">isolation_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="304">            <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">(</span><span class="n">ty</span><span class="o">=</span><span class="n">ScopeType</span><span class="o">.</span><span class="n">ISOLATION</span><span class="p">)</span>
</span><span data-line="305">            <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">)</span>
</span><span data-line="306">
</span><span data-line="307">        <span class="k">return</span> <span class="n">isolation_scope</span></div>

</span><span data-line="308">
<div class="viewcode-block" id="Scope.set_isolation_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_isolation_scope">[docs]</a>
</span><span data-line="309">    <span class="nd">@classmethod</span>
</span><span data-line="310">    <span class="k">def</span><span class="w"> </span><span class="nf">set_isolation_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_isolation_scope</span><span class="p">):</span>
</span><span data-line="311">        <span class="c1"># type: (Scope) -&gt; None</span>
</span><span data-line="312"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="313"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span data-line="314">
</span><span data-line="315"><span class="sd">        Sets the given scope as the new isolation scope overwriting the existing isolation scope.</span>
</span><span data-line="316"><span class="sd">        :param new_isolation_scope: The scope to set as the new isolation scope.</span>
</span><span data-line="317"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="318">        <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_isolation_scope</span><span class="p">)</span></div>

</span><span data-line="319">
<div class="viewcode-block" id="Scope.get_global_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_global_scope">[docs]</a>
</span><span data-line="320">    <span class="nd">@classmethod</span>
</span><span data-line="321">    <span class="k">def</span><span class="w"> </span><span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span data-line="322">        <span class="c1"># type: () -&gt; Scope</span>
</span><span data-line="323"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="324"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span data-line="325">
</span><span data-line="326"><span class="sd">        Returns the global scope.</span>
</span><span data-line="327"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="328">        <span class="k">global</span> <span class="n">_global_scope</span>
</span><span data-line="329">        <span class="k">if</span> <span class="n">_global_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="330">            <span class="n">_global_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">(</span><span class="n">ty</span><span class="o">=</span><span class="n">ScopeType</span><span class="o">.</span><span class="n">GLOBAL</span><span class="p">)</span>
</span><span data-line="331">
</span><span data-line="332">        <span class="k">return</span> <span class="n">_global_scope</span></div>

</span><span data-line="333">
<div class="viewcode-block" id="Scope.last_event_id">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.last_event_id">[docs]</a>
</span><span data-line="334">    <span class="nd">@classmethod</span>
</span><span data-line="335">    <span class="k">def</span><span class="w"> </span><span class="nf">last_event_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span data-line="336">        <span class="c1"># type: () -&gt; Optional[str]</span>
</span><span data-line="337"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="338"><span class="sd">        .. versionadded:: 2.2.0</span>
</span><span data-line="339">
</span><span data-line="340"><span class="sd">        Returns event ID of the event most recently captured by the isolation scope, or None if no event</span>
</span><span data-line="341"><span class="sd">        has been captured. We do not consider events that are dropped, e.g. by a before_send hook.</span>
</span><span data-line="342"><span class="sd">        Transactions also are not considered events in this context.</span>
</span><span data-line="343">
</span><span data-line="344"><span class="sd">        The event corresponding to the returned event ID is NOT guaranteed to actually be sent to Sentry;</span>
</span><span data-line="345"><span class="sd">        whether the event is sent depends on the transport. The event could be sent later or not at all.</span>
</span><span data-line="346"><span class="sd">        Even a sent event could fail to arrive in Sentry due to network issues, exhausted quotas, or</span>
</span><span data-line="347"><span class="sd">        various other reasons.</span>
</span><span data-line="348"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="349">        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_last_event_id</span></div>

</span><span data-line="350">
</span><span data-line="351">    <span class="k">def</span><span class="w"> </span><span class="nf">_merge_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">additional_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_scope_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="352">        <span class="c1"># type: (Optional[Scope], Optional[Dict[str, Any]]) -&gt; Scope</span>
</span><span data-line="353"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="354"><span class="sd">        Merges global, isolation and current scope into a new scope and</span>
</span><span data-line="355"><span class="sd">        adds the given additional scope or additional scope kwargs to it.</span>
</span><span data-line="356"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="357">        <span class="k">if</span> <span class="n">additional_scope</span> <span class="ow">and</span> <span class="n">additional_scope_kwargs</span><span class="p">:</span>
</span><span data-line="358">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot provide scope and kwargs&quot;</span><span class="p">)</span>
</span><span data-line="359">
</span><span data-line="360">        <span class="n">final_scope</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">_global_scope</span><span class="p">)</span> <span class="k">if</span> <span class="n">_global_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Scope</span><span class="p">()</span>
</span><span data-line="361">        <span class="n">final_scope</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">ScopeType</span><span class="o">.</span><span class="n">MERGED</span>
</span><span data-line="362">
</span><span data-line="363">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="364">        <span class="k">if</span> <span class="n">isolation_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="365">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">)</span>
</span><span data-line="366">
</span><span data-line="367">        <span class="n">current_scope</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="368">        <span class="k">if</span> <span class="n">current_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="369">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="n">current_scope</span><span class="p">)</span>
</span><span data-line="370">
</span><span data-line="371">        <span class="k">if</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">current_scope</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">isolation_scope</span><span class="p">:</span>
</span><span data-line="372">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="373">
</span><span data-line="374">        <span class="k">if</span> <span class="n">additional_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="375">            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">additional_scope</span><span class="p">):</span>
</span><span data-line="376">                <span class="n">additional_scope</span><span class="p">(</span><span class="n">final_scope</span><span class="p">)</span>
</span><span data-line="377">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="378">                <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="n">additional_scope</span><span class="p">)</span>
</span><span data-line="379">
</span><span data-line="380">        <span class="k">elif</span> <span class="n">additional_scope_kwargs</span><span class="p">:</span>
</span><span data-line="381">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">additional_scope_kwargs</span><span class="p">)</span>
</span><span data-line="382">
</span><span data-line="383">        <span class="k">return</span> <span class="n">final_scope</span>
</span><span data-line="384">
<div class="viewcode-block" id="Scope.get_client">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_client">[docs]</a>
</span><span data-line="385">    <span class="nd">@classmethod</span>
</span><span data-line="386">    <span class="k">def</span><span class="w"> </span><span class="nf">get_client</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span data-line="387">        <span class="c1"># type: () -&gt; sentry_sdk.client.BaseClient</span>
</span><span data-line="388"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="389"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span data-line="390">
</span><span data-line="391"><span class="sd">        Returns the currently used :py:class:`sentry_sdk.Client`.</span>
</span><span data-line="392"><span class="sd">        This checks the current scope, the isolation scope and the global scope for a client.</span>
</span><span data-line="393"><span class="sd">        If no client is available a :py:class:`sentry_sdk.client.NonRecordingClient` is returned.</span>
</span><span data-line="394"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="395">        <span class="n">current_scope</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="396">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="397">            <span class="n">client</span> <span class="o">=</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">client</span>
</span><span data-line="398">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span data-line="399">            <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="400">
</span><span data-line="401">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
</span><span data-line="402">            <span class="k">return</span> <span class="n">client</span>
</span><span data-line="403">
</span><span data-line="404">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="405">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="406">            <span class="n">client</span> <span class="o">=</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">client</span>
</span><span data-line="407">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span data-line="408">            <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="409">
</span><span data-line="410">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
</span><span data-line="411">            <span class="k">return</span> <span class="n">client</span>
</span><span data-line="412">
</span><span data-line="413">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="414">            <span class="n">client</span> <span class="o">=</span> <span class="n">_global_scope</span><span class="o">.</span><span class="n">client</span>  <span class="c1"># type: ignore</span>
</span><span data-line="415">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span data-line="416">            <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="417">
</span><span data-line="418">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
</span><span data-line="419">            <span class="k">return</span> <span class="n">client</span>
</span><span data-line="420">
</span><span data-line="421">        <span class="k">return</span> <span class="n">NonRecordingClient</span><span class="p">()</span></div>

</span><span data-line="422">
<div class="viewcode-block" id="Scope.set_client">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_client">[docs]</a>
</span><span data-line="423">    <span class="k">def</span><span class="w"> </span><span class="nf">set_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="424">        <span class="c1"># type: (Optional[sentry_sdk.client.BaseClient]) -&gt; None</span>
</span><span data-line="425"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="426"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span data-line="427">
</span><span data-line="428"><span class="sd">        Sets the client for this scope.</span>
</span><span data-line="429">
</span><span data-line="430"><span class="sd">        :param client: The client to use in this scope.</span>
</span><span data-line="431"><span class="sd">            If `None` the client of the scope will be replaced by a :py:class:`sentry_sdk.NonRecordingClient`.</span>
</span><span data-line="432">
</span><span data-line="433"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="434">        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span> <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">NonRecordingClient</span><span class="p">()</span></div>

</span><span data-line="435">
<div class="viewcode-block" id="Scope.fork">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.fork">[docs]</a>
</span><span data-line="436">    <span class="k">def</span><span class="w"> </span><span class="nf">fork</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="437">        <span class="c1"># type: () -&gt; Scope</span>
</span><span data-line="438"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="439"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span data-line="440">
</span><span data-line="441"><span class="sd">        Returns a fork of this scope.</span>
</span><span data-line="442"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="443">        <span class="n">forked_scope</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="444">        <span class="k">return</span> <span class="n">forked_scope</span></div>

</span><span data-line="445">
</span><span data-line="446">    <span class="k">def</span><span class="w"> </span><span class="nf">_load_trace_data_from_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="447">        <span class="c1"># type: () -&gt; Optional[Dict[str, str]]</span>
</span><span data-line="448"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="449"><span class="sd">        Load Sentry trace id and baggage from environment variables.</span>
</span><span data-line="450"><span class="sd">        Can be disabled by setting SENTRY_USE_ENVIRONMENT to &quot;false&quot;.</span>
</span><span data-line="451"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="452">        <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="453">
</span><span data-line="454">        <span class="n">sentry_use_environment</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="455">            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_USE_ENVIRONMENT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="456">        <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span data-line="457">        <span class="n">use_environment</span> <span class="o">=</span> <span class="n">sentry_use_environment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FALSE_VALUES</span>
</span><span data-line="458">        <span class="k">if</span> <span class="n">use_environment</span><span class="p">:</span>
</span><span data-line="459">            <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="460">
</span><span data-line="461">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_TRACE&quot;</span><span class="p">):</span>
</span><span data-line="462">                <span class="n">incoming_trace_information</span><span class="p">[</span><span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="463">                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_TRACE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="464">                <span class="p">)</span>
</span><span data-line="465">
</span><span data-line="466">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_BAGGAGE&quot;</span><span class="p">):</span>
</span><span data-line="467">                <span class="n">incoming_trace_information</span><span class="p">[</span><span class="n">BAGGAGE_HEADER_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="468">                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_BAGGAGE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="469">                <span class="p">)</span>
</span><span data-line="470">
</span><span data-line="471">        <span class="k">return</span> <span class="n">incoming_trace_information</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span data-line="472">
<div class="viewcode-block" id="Scope.set_new_propagation_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_new_propagation_context">[docs]</a>
</span><span data-line="473">    <span class="k">def</span><span class="w"> </span><span class="nf">set_new_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="474">        <span class="c1"># type: () -&gt; None</span>
</span><span data-line="475"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="476"><span class="sd">        Creates a new propagation context and sets it as `_propagation_context`. Overwriting existing one.</span>
</span><span data-line="477"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="478">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="n">PropagationContext</span><span class="p">()</span></div>

</span><span data-line="479">
<div class="viewcode-block" id="Scope.generate_propagation_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.generate_propagation_context">[docs]</a>
</span><span data-line="480">    <span class="k">def</span><span class="w"> </span><span class="nf">generate_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incoming_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="481">        <span class="c1"># type: (Optional[Dict[str, str]]) -&gt; None</span>
</span><span data-line="482"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="483"><span class="sd">        Makes sure the propagation context is set on the scope.</span>
</span><span data-line="484"><span class="sd">        If there is `incoming_data` overwrite existing propagation context.</span>
</span><span data-line="485"><span class="sd">        If there is no `incoming_data` create new propagation context, but do NOT overwrite if already existing.</span>
</span><span data-line="486"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="487">        <span class="k">if</span> <span class="n">incoming_data</span><span class="p">:</span>
</span><span data-line="488">            <span class="n">propagation_context</span> <span class="o">=</span> <span class="n">PropagationContext</span><span class="o">.</span><span class="n">from_incoming_data</span><span class="p">(</span><span class="n">incoming_data</span><span class="p">)</span>
</span><span data-line="489">            <span class="k">if</span> <span class="n">propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="490">                <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="n">propagation_context</span>
</span><span data-line="491">
</span><span data-line="492">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">!=</span> <span class="n">ScopeType</span><span class="o">.</span><span class="n">CURRENT</span><span class="p">:</span>
</span><span data-line="493">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="494">                <span class="bp">self</span><span class="o">.</span><span class="n">set_new_propagation_context</span><span class="p">()</span></div>

</span><span data-line="495">
<div class="viewcode-block" id="Scope.get_dynamic_sampling_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_dynamic_sampling_context">[docs]</a>
</span><span data-line="496">    <span class="k">def</span><span class="w"> </span><span class="nf">get_dynamic_sampling_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="497">        <span class="c1"># type: () -&gt; Optional[Dict[str, str]]</span>
</span><span data-line="498"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="499"><span class="sd">        Returns the Dynamic Sampling Context from the Propagation Context.</span>
</span><span data-line="500"><span class="sd">        If not existing, creates a new one.</span>
</span><span data-line="501"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="502">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="503">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="504">
</span><span data-line="505">        <span class="n">baggage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_baggage</span><span class="p">()</span>
</span><span data-line="506">        <span class="k">if</span> <span class="n">baggage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="507">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">dynamic_sampling_context</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="508">                <span class="n">baggage</span><span class="o">.</span><span class="n">dynamic_sampling_context</span><span class="p">()</span>
</span><span data-line="509">            <span class="p">)</span>
</span><span data-line="510">
</span><span data-line="511">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">dynamic_sampling_context</span></div>

</span><span data-line="512">
<div class="viewcode-block" id="Scope.get_traceparent">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_traceparent">[docs]</a>
</span><span data-line="513">    <span class="k">def</span><span class="w"> </span><span class="nf">get_traceparent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="514">        <span class="c1"># type: (Any, Any) -&gt; Optional[str]</span>
</span><span data-line="515"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="516"><span class="sd">        Returns the Sentry &quot;sentry-trace&quot; header (aka the traceparent) from the</span>
</span><span data-line="517"><span class="sd">        currently active span or the scopes Propagation Context.</span>
</span><span data-line="518"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="519">        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span data-line="520">
</span><span data-line="521">        <span class="c1"># If we have an active span, return traceparent from there</span>
</span><span data-line="522">        <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="523">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">to_traceparent</span><span class="p">()</span>
</span><span data-line="524">
</span><span data-line="525">        <span class="c1"># If this scope has a propagation context, return traceparent from there</span>
</span><span data-line="526">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="527">            <span class="n">traceparent</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span data-line="528">                <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">trace_id</span><span class="p">,</span>
</span><span data-line="529">                <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">span_id</span><span class="p">,</span>
</span><span data-line="530">            <span class="p">)</span>
</span><span data-line="531">            <span class="k">return</span> <span class="n">traceparent</span>
</span><span data-line="532">
</span><span data-line="533">        <span class="c1"># Fall back to isolation scope&#39;s traceparent. It always has one</span>
</span><span data-line="534">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">()</span></div>

</span><span data-line="535">
<div class="viewcode-block" id="Scope.get_baggage">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_baggage">[docs]</a>
</span><span data-line="536">    <span class="k">def</span><span class="w"> </span><span class="nf">get_baggage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="537">        <span class="c1"># type: (Any, Any) -&gt; Optional[Baggage]</span>
</span><span data-line="538"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="539"><span class="sd">        Returns the Sentry &quot;baggage&quot; header containing trace information from the</span>
</span><span data-line="540"><span class="sd">        currently active span or the scopes Propagation Context.</span>
</span><span data-line="541"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="542">        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span data-line="543">
</span><span data-line="544">        <span class="c1"># If we have an active span, return baggage from there</span>
</span><span data-line="545">        <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="546">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">to_baggage</span><span class="p">()</span>
</span><span data-line="547">
</span><span data-line="548">        <span class="c1"># If this scope has a propagation context, return baggage from there</span>
</span><span data-line="549">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="550">            <span class="n">dynamic_sampling_context</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="551">                <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">dynamic_sampling_context</span>
</span><span data-line="552">            <span class="p">)</span>
</span><span data-line="553">            <span class="k">if</span> <span class="n">dynamic_sampling_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="554">                <span class="k">return</span> <span class="n">Baggage</span><span class="o">.</span><span class="n">from_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="555">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="556">                <span class="k">return</span> <span class="n">Baggage</span><span class="p">(</span><span class="n">dynamic_sampling_context</span><span class="p">)</span>
</span><span data-line="557">
</span><span data-line="558">        <span class="c1"># Fall back to isolation scope&#39;s baggage. It always has one</span>
</span><span data-line="559">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">get_baggage</span><span class="p">()</span></div>

</span><span data-line="560">
<div class="viewcode-block" id="Scope.get_trace_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_trace_context">[docs]</a>
</span><span data-line="561">    <span class="k">def</span><span class="w"> </span><span class="nf">get_trace_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="562">        <span class="c1"># type: () -&gt; Any</span>
</span><span data-line="563"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="564"><span class="sd">        Returns the Sentry &quot;trace&quot; context from the Propagation Context.</span>
</span><span data-line="565"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="566">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="567">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="568">
</span><span data-line="569">        <span class="n">trace_context</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="570">            <span class="s2">&quot;trace_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">trace_id</span><span class="p">,</span>
</span><span data-line="571">            <span class="s2">&quot;span_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">span_id</span><span class="p">,</span>
</span><span data-line="572">            <span class="s2">&quot;parent_span_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">parent_span_id</span><span class="p">,</span>
</span><span data-line="573">            <span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_sampling_context</span><span class="p">(),</span>
</span><span data-line="574">        <span class="p">}</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span data-line="575">
</span><span data-line="576">        <span class="k">return</span> <span class="n">trace_context</span></div>

</span><span data-line="577">
<div class="viewcode-block" id="Scope.trace_propagation_meta">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.trace_propagation_meta">[docs]</a>
</span><span data-line="578">    <span class="k">def</span><span class="w"> </span><span class="nf">trace_propagation_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="579">        <span class="c1"># type: (*Any, **Any) -&gt; str</span>
</span><span data-line="580"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="581"><span class="sd">        Return meta tags which should be injected into HTML templates</span>
</span><span data-line="582"><span class="sd">        to allow propagation of trace information.</span>
</span><span data-line="583"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="584">        <span class="n">span</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="585">        <span class="k">if</span> <span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="586">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="587">                <span class="s2">&quot;The parameter `span` in trace_propagation_meta() is deprecated and will be removed in the future.&quot;</span>
</span><span data-line="588">            <span class="p">)</span>
</span><span data-line="589">
</span><span data-line="590">        <span class="n">meta</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="591">
</span><span data-line="592">        <span class="n">sentry_trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">()</span>
</span><span data-line="593">        <span class="k">if</span> <span class="n">sentry_trace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="594">            <span class="n">meta</span> <span class="o">+=</span> <span class="s1">&#39;&lt;meta name=&quot;</span><span class="si">%s</span><span class="s1">&quot; content=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span><span data-line="595">                <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span>
</span><span data-line="596">                <span class="n">sentry_trace</span><span class="p">,</span>
</span><span data-line="597">            <span class="p">)</span>
</span><span data-line="598">
</span><span data-line="599">        <span class="n">baggage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_baggage</span><span class="p">()</span>
</span><span data-line="600">        <span class="k">if</span> <span class="n">baggage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="601">            <span class="n">meta</span> <span class="o">+=</span> <span class="s1">&#39;&lt;meta name=&quot;</span><span class="si">%s</span><span class="s1">&quot; content=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span><span data-line="602">                <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span>
</span><span data-line="603">                <span class="n">baggage</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span>
</span><span data-line="604">            <span class="p">)</span>
</span><span data-line="605">
</span><span data-line="606">        <span class="k">return</span> <span class="n">meta</span></div>

</span><span data-line="607">
<div class="viewcode-block" id="Scope.iter_headers">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.iter_headers">[docs]</a>
</span><span data-line="608">    <span class="k">def</span><span class="w"> </span><span class="nf">iter_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="609">        <span class="c1"># type: () -&gt; Iterator[Tuple[str, str]]</span>
</span><span data-line="610"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="611"><span class="sd">        Creates a generator which returns the `sentry-trace` and `baggage` headers from the Propagation Context.</span>
</span><span data-line="612"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="613">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="614">            <span class="n">traceparent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">()</span>
</span><span data-line="615">            <span class="k">if</span> <span class="n">traceparent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="616">                <span class="k">yield</span> <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span> <span class="n">traceparent</span>
</span><span data-line="617">
</span><span data-line="618">            <span class="n">dsc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_sampling_context</span><span class="p">()</span>
</span><span data-line="619">            <span class="k">if</span> <span class="n">dsc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="620">                <span class="n">baggage</span> <span class="o">=</span> <span class="n">Baggage</span><span class="p">(</span><span class="n">dsc</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span data-line="621">                <span class="k">yield</span> <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span> <span class="n">baggage</span></div>

</span><span data-line="622">
<div class="viewcode-block" id="Scope.iter_trace_propagation_headers">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.iter_trace_propagation_headers">[docs]</a>
</span><span data-line="623">    <span class="k">def</span><span class="w"> </span><span class="nf">iter_trace_propagation_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="624">        <span class="c1"># type: (Any, Any) -&gt; Generator[Tuple[str, str], None, None]</span>
</span><span data-line="625"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="626"><span class="sd">        Return HTTP headers which allow propagation of trace data.</span>
</span><span data-line="627">
</span><span data-line="628"><span class="sd">        If a span is given, the trace data will taken from the span.</span>
</span><span data-line="629"><span class="sd">        If no span is given, the trace data is taken from the scope.</span>
</span><span data-line="630"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="631">        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span data-line="632">        <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;propagate_traces&quot;</span><span class="p">):</span>
</span><span data-line="633">            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span data-line="634">                <span class="s2">&quot;The `propagate_traces` parameter is deprecated. Please use `trace_propagation_targets` instead.&quot;</span><span class="p">,</span>
</span><span data-line="635">                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span data-line="636">                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="637">            <span class="p">)</span>
</span><span data-line="638">            <span class="k">return</span>
</span><span data-line="639">
</span><span data-line="640">        <span class="n">span</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="641">        <span class="n">span</span> <span class="o">=</span> <span class="n">span</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span>
</span><span data-line="642">
</span><span data-line="643">        <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="644">            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span data-line="645">                <span class="k">yield</span> <span class="n">header</span>
</span><span data-line="646">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="647">            <span class="c1"># If this scope has a propagation context, return headers from there</span>
</span><span data-line="648">            <span class="c1"># (it could be that self is not the current scope nor the isolation scope)</span>
</span><span data-line="649">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="650">                <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span data-line="651">                    <span class="k">yield</span> <span class="n">header</span>
</span><span data-line="652">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="653">                <span class="c1"># otherwise try headers from current scope</span>
</span><span data-line="654">                <span class="n">current_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span data-line="655">                <span class="k">if</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="656">                    <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span data-line="657">                        <span class="k">yield</span> <span class="n">header</span>
</span><span data-line="658">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="659">                    <span class="c1"># otherwise fall back to headers from isolation scope</span>
</span><span data-line="660">                    <span class="n">isolation_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span>
</span><span data-line="661">                    <span class="k">if</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="662">                        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span data-line="663">                            <span class="k">yield</span> <span class="n">header</span></div>

</span><span data-line="664">
</span><span data-line="665">    <span class="k">def</span><span class="w"> </span><span class="nf">get_active_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="666">        <span class="c1"># type: () -&gt; Optional[PropagationContext]</span>
</span><span data-line="667">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="668">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span data-line="669">
</span><span data-line="670">        <span class="n">current_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span data-line="671">        <span class="k">if</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="672">            <span class="k">return</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span data-line="673">
</span><span data-line="674">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span>
</span><span data-line="675">        <span class="k">if</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="676">            <span class="k">return</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span data-line="677">
</span><span data-line="678">        <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="679">
<div class="viewcode-block" id="Scope.clear">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.clear">[docs]</a>
</span><span data-line="680">    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="681">        <span class="c1"># type: () -&gt; None</span>
</span><span data-line="682"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clears the entire scope.&quot;&quot;&quot;</span>
</span><span data-line="683">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[LogLevelStr]</span>
</span><span data-line="684">        <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[List[str]]</span>
</span><span data-line="685">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
</span><span data-line="686">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: dict[str, str]</span>
</span><span data-line="687">        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span data-line="688">
</span><span data-line="689">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span data-line="690">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Dict[str, Any]]</span>
</span><span data-line="691">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: dict[str, Any]</span>
</span><span data-line="692">        <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Attachment]</span>
</span><span data-line="693">
</span><span data-line="694">        <span class="bp">self</span><span class="o">.</span><span class="n">clear_breadcrumbs</span><span class="p">()</span>
</span><span data-line="695">        <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># type: bool</span>
</span><span data-line="696">
</span><span data-line="697">        <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Span]</span>
</span><span data-line="698">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Session]</span>
</span><span data-line="699">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[bool]</span>
</span><span data-line="700">
</span><span data-line="701">        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Profile]</span>
</span><span data-line="702">
</span><span data-line="703">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="704">
</span><span data-line="705">        <span class="c1"># self._last_event_id is only applicable to isolation scopes</span>
</span><span data-line="706">        <span class="bp">self</span><span class="o">.</span><span class="n">_last_event_id</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
</span><span data-line="707">        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[FlagBuffer]</span></div>

</span><span data-line="708">
</span><span data-line="709">    <span class="nd">@_attr_setter</span>
</span><span data-line="710">    <span class="k">def</span><span class="w"> </span><span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span data-line="711">        <span class="c1"># type: (LogLevelStr) -&gt; None</span>
</span><span data-line="712"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="713"><span class="sd">        When set this overrides the level.</span>
</span><span data-line="714">
</span><span data-line="715"><span class="sd">        .. deprecated:: 1.0.0</span>
</span><span data-line="716"><span class="sd">            Use :func:`set_level` instead.</span>
</span><span data-line="717">
</span><span data-line="718"><span class="sd">        :param value: The level to set.</span>
</span><span data-line="719"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="720">        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="721">            <span class="s2">&quot;Deprecated: use .set_level() instead. This will be removed in the future.&quot;</span>
</span><span data-line="722">        <span class="p">)</span>
</span><span data-line="723">
</span><span data-line="724">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="725">
<div class="viewcode-block" id="Scope.set_level">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_level">[docs]</a>
</span><span data-line="726">    <span class="k">def</span><span class="w"> </span><span class="nf">set_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span data-line="727">        <span class="c1"># type: (LogLevelStr) -&gt; None</span>
</span><span data-line="728"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="729"><span class="sd">        Sets the level for the scope.</span>
</span><span data-line="730">
</span><span data-line="731"><span class="sd">        :param value: The level to set.</span>
</span><span data-line="732"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="733">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span data-line="734">
</span><span data-line="735">    <span class="nd">@_attr_setter</span>
</span><span data-line="736">    <span class="k">def</span><span class="w"> </span><span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span data-line="737">        <span class="c1"># type: (Optional[List[str]]) -&gt; None</span>
</span><span data-line="738"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set this overrides the default fingerprint.&quot;&quot;&quot;</span>
</span><span data-line="739">        <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="740">
</span><span data-line="741">    <span class="nd">@property</span>
</span><span data-line="742">    <span class="k">def</span><span class="w"> </span><span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="743">        <span class="c1"># type: () -&gt; Any</span>
</span><span data-line="744">        <span class="c1"># would be type: () -&gt; Optional[Transaction], see https://github.com/python/mypy/issues/3004</span>
</span><span data-line="745"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the transaction (root span) in the scope, if any.&quot;&quot;&quot;</span>
</span><span data-line="746">
</span><span data-line="747">        <span class="c1"># there is no span/transaction on the scope</span>
</span><span data-line="748">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="749">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="750">
</span><span data-line="751">        <span class="c1"># there is an orphan span on the scope</span>
</span><span data-line="752">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="753">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="754">
</span><span data-line="755">        <span class="c1"># there is either a transaction (which is its own containing</span>
</span><span data-line="756">        <span class="c1"># transaction) or a non-orphan span on the scope</span>
</span><span data-line="757">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span>
</span><span data-line="758">
</span><span data-line="759">    <span class="nd">@transaction</span><span class="o">.</span><span class="n">setter</span>
</span><span data-line="760">    <span class="k">def</span><span class="w"> </span><span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span data-line="761">        <span class="c1"># type: (Any) -&gt; None</span>
</span><span data-line="762">        <span class="c1"># would be type: (Optional[str]) -&gt; None, see https://github.com/python/mypy/issues/3004</span>
</span><span data-line="763"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set this forces a specific transaction name to be set.</span>
</span><span data-line="764">
</span><span data-line="765"><span class="sd">        Deprecated: use set_transaction_name instead.&quot;&quot;&quot;</span>
</span><span data-line="766">
</span><span data-line="767">        <span class="c1"># XXX: the docstring above is misleading. The implementation of</span>
</span><span data-line="768">        <span class="c1"># apply_to_event prefers an existing value of event.transaction over</span>
</span><span data-line="769">        <span class="c1"># anything set in the scope.</span>
</span><span data-line="770">        <span class="c1"># XXX: note that with the introduction of the Scope.transaction getter,</span>
</span><span data-line="771">        <span class="c1"># there is a semantic and type mismatch between getter and setter. The</span>
</span><span data-line="772">        <span class="c1"># getter returns a Transaction, the setter sets a transaction name.</span>
</span><span data-line="773">        <span class="c1"># Without breaking version compatibility, we could make the setter set a</span>
</span><span data-line="774">        <span class="c1"># transaction name or transaction (self._span) depending on the type of</span>
</span><span data-line="775">        <span class="c1"># the value argument.</span>
</span><span data-line="776">
</span><span data-line="777">        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="778">            <span class="s2">&quot;Assigning to scope.transaction directly is deprecated: use scope.set_transaction_name() instead.&quot;</span>
</span><span data-line="779">        <span class="p">)</span>
</span><span data-line="780">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="781">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="p">:</span>
</span><span data-line="782">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="783">
<div class="viewcode-block" id="Scope.set_transaction_name">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_transaction_name">[docs]</a>
</span><span data-line="784">    <span class="k">def</span><span class="w"> </span><span class="nf">set_transaction_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="785">        <span class="c1"># type: (str, Optional[str]) -&gt; None</span>
</span><span data-line="786"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the transaction name and optionally the transaction source.&quot;&quot;&quot;</span>
</span><span data-line="787">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">name</span>
</span><span data-line="788">
</span><span data-line="789">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="p">:</span>
</span><span data-line="790">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span data-line="791">            <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
</span><span data-line="792">                <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
</span><span data-line="793">
</span><span data-line="794">        <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
</span><span data-line="795">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span></div>

</span><span data-line="796">
</span><span data-line="797">    <span class="nd">@_attr_setter</span>
</span><span data-line="798">    <span class="k">def</span><span class="w"> </span><span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span data-line="799">        <span class="c1"># type: (Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="800"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set a specific user is bound to the scope. Deprecated in favor of set_user.&quot;&quot;&quot;</span>
</span><span data-line="801">        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span data-line="802">            <span class="s2">&quot;The `Scope.user` setter is deprecated in favor of `Scope.set_user()`.&quot;</span><span class="p">,</span>
</span><span data-line="803">            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span data-line="804">            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="805">        <span class="p">)</span>
</span><span data-line="806">        <span class="bp">self</span><span class="o">.</span><span class="n">set_user</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span data-line="807">
<div class="viewcode-block" id="Scope.set_user">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_user">[docs]</a>
</span><span data-line="808">    <span class="k">def</span><span class="w"> </span><span class="nf">set_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span data-line="809">        <span class="c1"># type: (Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="810"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets a user for the scope.&quot;&quot;&quot;</span>
</span><span data-line="811">        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="812">        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_session</span>
</span><span data-line="813">        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="814">            <span class="n">session</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

</span><span data-line="815">
</span><span data-line="816">    <span class="nd">@property</span>
</span><span data-line="817">    <span class="k">def</span><span class="w"> </span><span class="nf">span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="818">        <span class="c1"># type: () -&gt; Optional[Span]</span>
</span><span data-line="819"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get/set current tracing span or transaction.&quot;&quot;&quot;</span>
</span><span data-line="820">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span>
</span><span data-line="821">
</span><span data-line="822">    <span class="nd">@span</span><span class="o">.</span><span class="n">setter</span>
</span><span data-line="823">    <span class="k">def</span><span class="w"> </span><span class="nf">span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">):</span>
</span><span data-line="824">        <span class="c1"># type: (Optional[Span]) -&gt; None</span>
</span><span data-line="825">        <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="n">span</span>
</span><span data-line="826">        <span class="c1"># XXX: this differs from the implementation in JS, there Scope.setSpan</span>
</span><span data-line="827">        <span class="c1"># does not set Scope._transactionName.</span>
</span><span data-line="828">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
</span><span data-line="829">            <span class="n">transaction</span> <span class="o">=</span> <span class="n">span</span>
</span><span data-line="830">            <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span data-line="831">                <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="832">                <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
</span><span data-line="833">                    <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">source</span>
</span><span data-line="834">
</span><span data-line="835">    <span class="nd">@property</span>
</span><span data-line="836">    <span class="k">def</span><span class="w"> </span><span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="837">        <span class="c1"># type: () -&gt; Optional[Profile]</span>
</span><span data-line="838">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>
</span><span data-line="839">
</span><span data-line="840">    <span class="nd">@profile</span><span class="o">.</span><span class="n">setter</span>
</span><span data-line="841">    <span class="k">def</span><span class="w"> </span><span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
</span><span data-line="842">        <span class="c1"># type: (Optional[Profile]) -&gt; None</span>
</span><span data-line="843">
</span><span data-line="844">        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">profile</span>
</span><span data-line="845">
<div class="viewcode-block" id="Scope.set_tag">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_tag">[docs]</a>
</span><span data-line="846">    <span class="k">def</span><span class="w"> </span><span class="nf">set_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span data-line="847">        <span class="c1"># type: (str, Any) -&gt; None</span>
</span><span data-line="848"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="849"><span class="sd">        Sets a tag for a key to a specific value.</span>
</span><span data-line="850">
</span><span data-line="851"><span class="sd">        :param key: Key of the tag to set.</span>
</span><span data-line="852">
</span><span data-line="853"><span class="sd">        :param value: Value of the tag to set.</span>
</span><span data-line="854"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="855">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span data-line="856">
<div class="viewcode-block" id="Scope.set_tags">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_tags">[docs]</a>
</span><span data-line="857">    <span class="k">def</span><span class="w"> </span><span class="nf">set_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
</span><span data-line="858">        <span class="c1"># type: (Mapping[str, object]) -&gt; None</span>
</span><span data-line="859"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets multiple tags at once.</span>
</span><span data-line="860">
</span><span data-line="861"><span class="sd">        This method updates multiple tags at once. The tags are passed as a dictionary</span>
</span><span data-line="862"><span class="sd">        or other mapping type.</span>
</span><span data-line="863">
</span><span data-line="864"><span class="sd">        Calling this method is equivalent to calling `set_tag` on each key-value pair</span>
</span><span data-line="865"><span class="sd">        in the mapping. If a tag key already exists in the scope, its value will be</span>
</span><span data-line="866"><span class="sd">        updated. If the tag key does not exist in the scope, the key-value pair will</span>
</span><span data-line="867"><span class="sd">        be added to the scope.</span>
</span><span data-line="868">
</span><span data-line="869"><span class="sd">        This method only modifies tag keys in the `tags` mapping passed to the method.</span>
</span><span data-line="870"><span class="sd">        `scope.set_tags({})` is, therefore, a no-op.</span>
</span><span data-line="871">
</span><span data-line="872"><span class="sd">        :param tags: A mapping of tag keys to tag values to set.</span>
</span><span data-line="873"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="874">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span></div>

</span><span data-line="875">
<div class="viewcode-block" id="Scope.remove_tag">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.remove_tag">[docs]</a>
</span><span data-line="876">    <span class="k">def</span><span class="w"> </span><span class="nf">remove_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span data-line="877">        <span class="c1"># type: (str) -&gt; None</span>
</span><span data-line="878"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="879"><span class="sd">        Removes a specific tag.</span>
</span><span data-line="880">
</span><span data-line="881"><span class="sd">        :param key: Key of the tag to remove.</span>
</span><span data-line="882"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="883">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span data-line="884">
<div class="viewcode-block" id="Scope.set_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_context">[docs]</a>
</span><span data-line="885">    <span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
</span><span data-line="886">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="887">        <span class="n">key</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span data-line="888">        <span class="n">value</span><span class="p">,</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span data-line="889">    <span class="p">):</span>
</span><span data-line="890">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="891"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="892"><span class="sd">        Binds a context at a certain key to a specific value.</span>
</span><span data-line="893"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="894">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span data-line="895">
<div class="viewcode-block" id="Scope.remove_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.remove_context">[docs]</a>
</span><span data-line="896">    <span class="k">def</span><span class="w"> </span><span class="nf">remove_context</span><span class="p">(</span>
</span><span data-line="897">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="898">        <span class="n">key</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span data-line="899">    <span class="p">):</span>
</span><span data-line="900">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="901"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a context.&quot;&quot;&quot;</span>
</span><span data-line="902">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span data-line="903">
<div class="viewcode-block" id="Scope.set_extra">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_extra">[docs]</a>
</span><span data-line="904">    <span class="k">def</span><span class="w"> </span><span class="nf">set_extra</span><span class="p">(</span>
</span><span data-line="905">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="906">        <span class="n">key</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span data-line="907">        <span class="n">value</span><span class="p">,</span>  <span class="c1"># type: Any</span>
</span><span data-line="908">    <span class="p">):</span>
</span><span data-line="909">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="910"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets an extra key to a specific value.&quot;&quot;&quot;</span>
</span><span data-line="911">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span data-line="912">
<div class="viewcode-block" id="Scope.remove_extra">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.remove_extra">[docs]</a>
</span><span data-line="913">    <span class="k">def</span><span class="w"> </span><span class="nf">remove_extra</span><span class="p">(</span>
</span><span data-line="914">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="915">        <span class="n">key</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span data-line="916">    <span class="p">):</span>
</span><span data-line="917">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="918"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a specific extra key.&quot;&quot;&quot;</span>
</span><span data-line="919">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span data-line="920">
<div class="viewcode-block" id="Scope.clear_breadcrumbs">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.clear_breadcrumbs">[docs]</a>
</span><span data-line="921">    <span class="k">def</span><span class="w"> </span><span class="nf">clear_breadcrumbs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="922">        <span class="c1"># type: () -&gt; None</span>
</span><span data-line="923"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clears breadcrumb buffer.&quot;&quot;&quot;</span>
</span><span data-line="924">        <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>  <span class="c1"># type: Deque[Breadcrumb]</span>
</span><span data-line="925">        <span class="bp">self</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span> <span class="o">=</span> <span class="mi">0</span></div>

</span><span data-line="926">
<div class="viewcode-block" id="Scope.add_attachment">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.add_attachment">[docs]</a>
</span><span data-line="927">    <span class="k">def</span><span class="w"> </span><span class="nf">add_attachment</span><span class="p">(</span>
</span><span data-line="928">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="929">        <span class="nb">bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Union[None, bytes, Callable[[], bytes]]</span>
</span><span data-line="930">        <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span data-line="931">        <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span data-line="932">        <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span data-line="933">        <span class="n">add_to_transactions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># type: bool</span>
</span><span data-line="934">    <span class="p">):</span>
</span><span data-line="935">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="936"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds an attachment to future events sent from this scope.</span>
</span><span data-line="937">
</span><span data-line="938"><span class="sd">        The parameters are the same as for the :py:class:`sentry_sdk.attachments.Attachment` constructor.</span>
</span><span data-line="939"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="940">        <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="941">            <span class="n">Attachment</span><span class="p">(</span>
</span><span data-line="942">                <span class="nb">bytes</span><span class="o">=</span><span class="nb">bytes</span><span class="p">,</span>
</span><span data-line="943">                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
</span><span data-line="944">                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
</span><span data-line="945">                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
</span><span data-line="946">                <span class="n">add_to_transactions</span><span class="o">=</span><span class="n">add_to_transactions</span><span class="p">,</span>
</span><span data-line="947">            <span class="p">)</span>
</span><span data-line="948">        <span class="p">)</span></div>

</span><span data-line="949">
<div class="viewcode-block" id="Scope.add_breadcrumb">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.add_breadcrumb">[docs]</a>
</span><span data-line="950">    <span class="k">def</span><span class="w"> </span><span class="nf">add_breadcrumb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crumb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="951">        <span class="c1"># type: (Optional[Breadcrumb], Optional[BreadcrumbHint], Any) -&gt; None</span>
</span><span data-line="952"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="953"><span class="sd">        Adds a breadcrumb.</span>
</span><span data-line="954">
</span><span data-line="955"><span class="sd">        :param crumb: Dictionary with the data as the sentry v7/v8 protocol expects.</span>
</span><span data-line="956">
</span><span data-line="957"><span class="sd">        :param hint: An optional value that can be used by `before_breadcrumb`</span>
</span><span data-line="958"><span class="sd">            to customize the breadcrumbs that are emitted.</span>
</span><span data-line="959"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="960">        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span data-line="961">
</span><span data-line="962">        <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
</span><span data-line="963">            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropped breadcrumb because no client bound&quot;</span><span class="p">)</span>
</span><span data-line="964">            <span class="k">return</span>
</span><span data-line="965">
</span><span data-line="966">        <span class="n">before_breadcrumb</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;before_breadcrumb&quot;</span><span class="p">)</span>
</span><span data-line="967">        <span class="n">max_breadcrumbs</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_breadcrumbs&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MAX_BREADCRUMBS</span><span class="p">)</span>
</span><span data-line="968">
</span><span data-line="969">        <span class="n">crumb</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">crumb</span> <span class="ow">or</span> <span class="p">())</span>  <span class="c1"># type: Breadcrumb</span>
</span><span data-line="970">        <span class="n">crumb</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="971">        <span class="k">if</span> <span class="ow">not</span> <span class="n">crumb</span><span class="p">:</span>
</span><span data-line="972">            <span class="k">return</span>
</span><span data-line="973">
</span><span data-line="974">        <span class="n">hint</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">hint</span> <span class="ow">or</span> <span class="p">())</span>  <span class="c1"># type: Hint</span>
</span><span data-line="975">
</span><span data-line="976">        <span class="k">if</span> <span class="n">crumb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="977">            <span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="978">        <span class="k">if</span> <span class="n">crumb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="979">            <span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
</span><span data-line="980">
</span><span data-line="981">        <span class="k">if</span> <span class="n">before_breadcrumb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="982">            <span class="n">new_crumb</span> <span class="o">=</span> <span class="n">before_breadcrumb</span><span class="p">(</span><span class="n">crumb</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span data-line="983">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="984">            <span class="n">new_crumb</span> <span class="o">=</span> <span class="n">crumb</span>
</span><span data-line="985">
</span><span data-line="986">        <span class="k">if</span> <span class="n">new_crumb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="987">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_crumb</span><span class="p">)</span>
</span><span data-line="988">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="989">            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;before breadcrumb dropped breadcrumb (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">crumb</span><span class="p">)</span>
</span><span data-line="990">
</span><span data-line="991">        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_breadcrumbs</span><span class="p">:</span>
</span><span data-line="992">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span data-line="993">            <span class="bp">self</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span> <span class="o">+=</span> <span class="mi">1</span></div>

</span><span data-line="994">
<div class="viewcode-block" id="Scope.start_transaction">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.start_transaction">[docs]</a>
</span><span data-line="995">    <span class="k">def</span><span class="w"> </span><span class="nf">start_transaction</span><span class="p">(</span>
</span><span data-line="996">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="997">        <span class="n">transaction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="998">        <span class="n">instrumenter</span><span class="o">=</span><span class="n">INSTRUMENTER</span><span class="o">.</span><span class="n">SENTRY</span><span class="p">,</span>
</span><span data-line="999">        <span class="n">custom_sampling_context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1000">        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span data-line="1001">    <span class="p">):</span>
</span><span data-line="1002">        <span class="c1"># type: (Optional[Transaction], str, Optional[SamplingContext], Unpack[TransactionKwargs]) -&gt; Union[Transaction, NoOpSpan]</span>
</span><span data-line="1003"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1004"><span class="sd">        Start and return a transaction.</span>
</span><span data-line="1005">
</span><span data-line="1006"><span class="sd">        Start an existing transaction if given, otherwise create and start a new</span>
</span><span data-line="1007"><span class="sd">        transaction with kwargs.</span>
</span><span data-line="1008">
</span><span data-line="1009"><span class="sd">        This is the entry point to manual tracing instrumentation.</span>
</span><span data-line="1010">
</span><span data-line="1011"><span class="sd">        A tree structure can be built by adding child spans to the transaction,</span>
</span><span data-line="1012"><span class="sd">        and child spans to other spans. To start a new child span within the</span>
</span><span data-line="1013"><span class="sd">        transaction or any span, call the respective `.start_child()` method.</span>
</span><span data-line="1014">
</span><span data-line="1015"><span class="sd">        Every child span must be finished before the transaction is finished,</span>
</span><span data-line="1016"><span class="sd">        otherwise the unfinished spans are discarded.</span>
</span><span data-line="1017">
</span><span data-line="1018"><span class="sd">        When used as context managers, spans and transactions are automatically</span>
</span><span data-line="1019"><span class="sd">        finished at the end of the `with` block. If not using context managers,</span>
</span><span data-line="1020"><span class="sd">        call the `.finish()` method.</span>
</span><span data-line="1021">
</span><span data-line="1022"><span class="sd">        When the transaction is finished, it will be sent to Sentry with all its</span>
</span><span data-line="1023"><span class="sd">        finished child spans.</span>
</span><span data-line="1024">
</span><span data-line="1025"><span class="sd">        :param transaction: The transaction to start. If omitted, we create and</span>
</span><span data-line="1026"><span class="sd">            start a new transaction.</span>
</span><span data-line="1027"><span class="sd">        :param instrumenter: This parameter is meant for internal use only. It</span>
</span><span data-line="1028"><span class="sd">            will be removed in the next major version.</span>
</span><span data-line="1029"><span class="sd">        :param custom_sampling_context: The transaction&#39;s custom sampling context.</span>
</span><span data-line="1030"><span class="sd">        :param kwargs: Optional keyword arguments to be passed to the Transaction</span>
</span><span data-line="1031"><span class="sd">            constructor. See :py:class:`sentry_sdk.tracing.Transaction` for</span>
</span><span data-line="1032"><span class="sd">            available arguments.</span>
</span><span data-line="1033"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1034">        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span data-line="1035">
</span><span data-line="1036">        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span data-line="1037">
</span><span data-line="1038">        <span class="n">configuration_instrumenter</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrumenter&quot;</span><span class="p">]</span>
</span><span data-line="1039">
</span><span data-line="1040">        <span class="k">if</span> <span class="n">instrumenter</span> <span class="o">!=</span> <span class="n">configuration_instrumenter</span><span class="p">:</span>
</span><span data-line="1041">            <span class="k">return</span> <span class="n">NoOpSpan</span><span class="p">()</span>
</span><span data-line="1042">
</span><span data-line="1043">        <span class="n">try_autostart_continuous_profiler</span><span class="p">()</span>
</span><span data-line="1044">
</span><span data-line="1045">        <span class="n">custom_sampling_context</span> <span class="o">=</span> <span class="n">custom_sampling_context</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span data-line="1046">
</span><span data-line="1047">        <span class="c1"># kwargs at this point has type TransactionKwargs, since we have removed</span>
</span><span data-line="1048">        <span class="c1"># the client and custom_sampling_context from it.</span>
</span><span data-line="1049">        <span class="n">transaction_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>  <span class="c1"># type: TransactionKwargs</span>
</span><span data-line="1050">
</span><span data-line="1051">        <span class="c1"># if we haven&#39;t been given a transaction, make one</span>
</span><span data-line="1052">        <span class="k">if</span> <span class="n">transaction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1053">            <span class="n">transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="p">(</span><span class="o">**</span><span class="n">transaction_kwargs</span><span class="p">)</span>
</span><span data-line="1054">
</span><span data-line="1055">        <span class="c1"># use traces_sample_rate, traces_sampler, and/or inheritance to make a</span>
</span><span data-line="1056">        <span class="c1"># sampling decision</span>
</span><span data-line="1057">        <span class="n">sampling_context</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="1058">            <span class="s2">&quot;transaction_context&quot;</span><span class="p">:</span> <span class="n">transaction</span><span class="o">.</span><span class="n">to_json</span><span class="p">(),</span>
</span><span data-line="1059">            <span class="s2">&quot;parent_sampled&quot;</span><span class="p">:</span> <span class="n">transaction</span><span class="o">.</span><span class="n">parent_sampled</span><span class="p">,</span>
</span><span data-line="1060">        <span class="p">}</span>
</span><span data-line="1061">        <span class="n">sampling_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_sampling_context</span><span class="p">)</span>
</span><span data-line="1062">        <span class="n">transaction</span><span class="o">.</span><span class="n">_set_initial_sampling_decision</span><span class="p">(</span><span class="n">sampling_context</span><span class="o">=</span><span class="n">sampling_context</span><span class="p">)</span>
</span><span data-line="1063">
</span><span data-line="1064">        <span class="c1"># update the sample rate in the dsc</span>
</span><span data-line="1065">        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">sample_rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1066">            <span class="n">propagation_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_propagation_context</span><span class="p">()</span>
</span><span data-line="1067">            <span class="k">if</span> <span class="n">propagation_context</span><span class="p">:</span>
</span><span data-line="1068">                <span class="n">dsc</span> <span class="o">=</span> <span class="n">propagation_context</span><span class="o">.</span><span class="n">dynamic_sampling_context</span>
</span><span data-line="1069">                <span class="k">if</span> <span class="n">dsc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1070">                    <span class="n">dsc</span><span class="p">[</span><span class="s2">&quot;sample_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">transaction</span><span class="o">.</span><span class="n">sample_rate</span><span class="p">)</span>
</span><span data-line="1071">            <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">_baggage</span><span class="p">:</span>
</span><span data-line="1072">                <span class="n">transaction</span><span class="o">.</span><span class="n">_baggage</span><span class="o">.</span><span class="n">sentry_items</span><span class="p">[</span><span class="s2">&quot;sample_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span data-line="1073">                    <span class="n">transaction</span><span class="o">.</span><span class="n">sample_rate</span>
</span><span data-line="1074">                <span class="p">)</span>
</span><span data-line="1075">
</span><span data-line="1076">        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">sampled</span><span class="p">:</span>
</span><span data-line="1077">            <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span>
</span><span data-line="1078">                <span class="n">transaction</span><span class="o">.</span><span class="n">sampled</span><span class="p">,</span> <span class="n">transaction</span><span class="o">.</span><span class="n">_start_timestamp_monotonic_ns</span>
</span><span data-line="1079">            <span class="p">)</span>
</span><span data-line="1080">            <span class="n">profile</span><span class="o">.</span><span class="n">_set_initial_sampling_decision</span><span class="p">(</span><span class="n">sampling_context</span><span class="o">=</span><span class="n">sampling_context</span><span class="p">)</span>
</span><span data-line="1081">
</span><span data-line="1082">            <span class="n">transaction</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">profile</span>
</span><span data-line="1083">
</span><span data-line="1084">            <span class="n">transaction</span><span class="o">.</span><span class="n">_continuous_profile</span> <span class="o">=</span> <span class="n">try_profile_lifecycle_trace_start</span><span class="p">()</span>
</span><span data-line="1085">
</span><span data-line="1086">            <span class="c1"># Typically, the profiler is set when the transaction is created. But when</span>
</span><span data-line="1087">            <span class="c1"># using the auto lifecycle, the profiler isn&#39;t running when the first</span>
</span><span data-line="1088">            <span class="c1"># transaction is started. So make sure we update the profiler id on it.</span>
</span><span data-line="1089">            <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">_continuous_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1090">                <span class="n">transaction</span><span class="o">.</span><span class="n">set_profiler_id</span><span class="p">(</span><span class="n">get_profiler_id</span><span class="p">())</span>
</span><span data-line="1091">
</span><span data-line="1092">            <span class="c1"># we don&#39;t bother to keep spans if we already know we&#39;re not going to</span>
</span><span data-line="1093">            <span class="c1"># send the transaction</span>
</span><span data-line="1094">            <span class="n">max_spans</span> <span class="o">=</span> <span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;_experiments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_spans&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="mi">1000</span>
</span><span data-line="1095">            <span class="n">transaction</span><span class="o">.</span><span class="n">init_span_recorder</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">max_spans</span><span class="p">)</span>
</span><span data-line="1096">
</span><span data-line="1097">        <span class="k">return</span> <span class="n">transaction</span></div>

</span><span data-line="1098">
<div class="viewcode-block" id="Scope.start_span">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.start_span">[docs]</a>
</span><span data-line="1099">    <span class="k">def</span><span class="w"> </span><span class="nf">start_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrumenter</span><span class="o">=</span><span class="n">INSTRUMENTER</span><span class="o">.</span><span class="n">SENTRY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="1100">        <span class="c1"># type: (str, Any) -&gt; Span</span>
</span><span data-line="1101"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1102"><span class="sd">        Start a span whose parent is the currently active span or transaction, if any.</span>
</span><span data-line="1103">
</span><span data-line="1104"><span class="sd">        The return value is a :py:class:`sentry_sdk.tracing.Span` instance,</span>
</span><span data-line="1105"><span class="sd">        typically used as a context manager to start and stop timing in a `with`</span>
</span><span data-line="1106"><span class="sd">        block.</span>
</span><span data-line="1107">
</span><span data-line="1108"><span class="sd">        Only spans contained in a transaction are sent to Sentry. Most</span>
</span><span data-line="1109"><span class="sd">        integrations start a transaction at the appropriate time, for example</span>
</span><span data-line="1110"><span class="sd">        for every incoming HTTP request. Use</span>
</span><span data-line="1111"><span class="sd">        :py:meth:`sentry_sdk.start_transaction` to start a new transaction when</span>
</span><span data-line="1112"><span class="sd">        one is not already in progress.</span>
</span><span data-line="1113">
</span><span data-line="1114"><span class="sd">        For supported `**kwargs` see :py:class:`sentry_sdk.tracing.Span`.</span>
</span><span data-line="1115">
</span><span data-line="1116"><span class="sd">        The instrumenter parameter is deprecated for user code, and it will</span>
</span><span data-line="1117"><span class="sd">        be removed in the next major version. Going forward, it should only</span>
</span><span data-line="1118"><span class="sd">        be used by the SDK itself.</span>
</span><span data-line="1119"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1120">        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1121">            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span data-line="1122">                <span class="s2">&quot;The `description` parameter is deprecated. Please use `name` instead.&quot;</span><span class="p">,</span>
</span><span data-line="1123">                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span data-line="1124">                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="1125">            <span class="p">)</span>
</span><span data-line="1126">
</span><span data-line="1127">        <span class="k">with</span> <span class="n">new_scope</span><span class="p">():</span>
</span><span data-line="1128">            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span data-line="1129">
</span><span data-line="1130">            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span data-line="1131">
</span><span data-line="1132">            <span class="n">configuration_instrumenter</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrumenter&quot;</span><span class="p">]</span>
</span><span data-line="1133">
</span><span data-line="1134">            <span class="k">if</span> <span class="n">instrumenter</span> <span class="o">!=</span> <span class="n">configuration_instrumenter</span><span class="p">:</span>
</span><span data-line="1135">                <span class="k">return</span> <span class="n">NoOpSpan</span><span class="p">()</span>
</span><span data-line="1136">
</span><span data-line="1137">            <span class="c1"># get current span or transaction</span>
</span><span data-line="1138">            <span class="n">span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">span</span>
</span><span data-line="1139">
</span><span data-line="1140">            <span class="k">if</span> <span class="n">span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1141">                <span class="c1"># New spans get the `trace_id` from the scope</span>
</span><span data-line="1142">                <span class="k">if</span> <span class="s2">&quot;trace_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span data-line="1143">                    <span class="n">propagation_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_propagation_context</span><span class="p">()</span>
</span><span data-line="1144">                    <span class="k">if</span> <span class="n">propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1145">                        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;trace_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">propagation_context</span><span class="o">.</span><span class="n">trace_id</span>
</span><span data-line="1146">
</span><span data-line="1147">                <span class="n">span</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="1148">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1149">                <span class="c1"># Children take `trace_id`` from the parent span.</span>
</span><span data-line="1150">                <span class="n">span</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="1151">
</span><span data-line="1152">            <span class="k">return</span> <span class="n">span</span></div>

</span><span data-line="1153">
<div class="viewcode-block" id="Scope.continue_trace">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.continue_trace">[docs]</a>
</span><span data-line="1154">    <span class="k">def</span><span class="w"> </span><span class="nf">continue_trace</span><span class="p">(</span>
</span><span data-line="1155">        <span class="bp">self</span><span class="p">,</span> <span class="n">environ_or_headers</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;manual&quot;</span>
</span><span data-line="1156">    <span class="p">):</span>
</span><span data-line="1157">        <span class="c1"># type: (Dict[str, Any], Optional[str], Optional[str], Optional[str], str) -&gt; Transaction</span>
</span><span data-line="1158"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1159"><span class="sd">        Sets the propagation context from environment or headers and returns a transaction.</span>
</span><span data-line="1160"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1161">        <span class="bp">self</span><span class="o">.</span><span class="n">generate_propagation_context</span><span class="p">(</span><span class="n">environ_or_headers</span><span class="p">)</span>
</span><span data-line="1162">
</span><span data-line="1163">        <span class="c1"># When we generate the propagation context, the sample_rand value is set</span>
</span><span data-line="1164">        <span class="c1"># if missing or invalid (we use the original value if it&#39;s valid).</span>
</span><span data-line="1165">        <span class="c1"># We want the transaction to use the same sample_rand value. Due to duplicated</span>
</span><span data-line="1166">        <span class="c1"># propagation logic in the transaction, we pass it in to avoid recomputing it</span>
</span><span data-line="1167">        <span class="c1"># in the transaction.</span>
</span><span data-line="1168">        <span class="c1"># TYPE SAFETY: self.generate_propagation_context() ensures that self._propagation_context</span>
</span><span data-line="1169">        <span class="c1"># is not None.</span>
</span><span data-line="1170">        <span class="n">sample_rand</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
</span><span data-line="1171">            <span class="n">PropagationContext</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span data-line="1172">        <span class="p">)</span><span class="o">.</span><span class="n">_sample_rand</span><span class="p">()</span>
</span><span data-line="1173">
</span><span data-line="1174">        <span class="n">transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="o">.</span><span class="n">continue_from_headers</span><span class="p">(</span>
</span><span data-line="1175">            <span class="n">normalize_incoming_data</span><span class="p">(</span><span class="n">environ_or_headers</span><span class="p">),</span>
</span><span data-line="1176">            <span class="n">_sample_rand</span><span class="o">=</span><span class="n">sample_rand</span><span class="p">,</span>
</span><span data-line="1177">            <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span>
</span><span data-line="1178">            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
</span><span data-line="1179">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="1180">            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span data-line="1181">        <span class="p">)</span>
</span><span data-line="1182">
</span><span data-line="1183">        <span class="k">return</span> <span class="n">transaction</span></div>

</span><span data-line="1184">
<div class="viewcode-block" id="Scope.capture_event">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.capture_event">[docs]</a>
</span><span data-line="1185">    <span class="k">def</span><span class="w"> </span><span class="nf">capture_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">):</span>
</span><span data-line="1186">        <span class="c1"># type: (Event, Optional[Hint], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span data-line="1187"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1188"><span class="sd">        Captures an event.</span>
</span><span data-line="1189">
</span><span data-line="1190"><span class="sd">        Merges given scope data and calls :py:meth:`sentry_sdk.client._Client.capture_event`.</span>
</span><span data-line="1191">
</span><span data-line="1192"><span class="sd">        :param event: A ready-made event that can be directly sent to Sentry.</span>
</span><span data-line="1193">
</span><span data-line="1194"><span class="sd">        :param hint: Contains metadata about the event that can be read from `before_send`, such as the original exception object or a HTTP request object.</span>
</span><span data-line="1195">
</span><span data-line="1196"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span data-line="1197"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span data-line="1198">
</span><span data-line="1199"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span data-line="1200"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span data-line="1201"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span data-line="1202">
</span><span data-line="1203"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.client._Client.capture_event`).</span>
</span><span data-line="1204"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1205">        <span class="k">if</span> <span class="n">disable_capture_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
</span><span data-line="1206">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1207">
</span><span data-line="1208">        <span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_scopes</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">scope_kwargs</span><span class="p">)</span>
</span><span data-line="1209">
</span><span data-line="1210">        <span class="n">event_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">)</span>
</span><span data-line="1211">
</span><span data-line="1212">        <span class="k">if</span> <span class="n">event_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;transaction&quot;</span><span class="p">:</span>
</span><span data-line="1213">            <span class="bp">self</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_last_event_id</span> <span class="o">=</span> <span class="n">event_id</span>
</span><span data-line="1214">
</span><span data-line="1215">        <span class="k">return</span> <span class="n">event_id</span></div>

</span><span data-line="1216">
<div class="viewcode-block" id="Scope.capture_message">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.capture_message">[docs]</a>
</span><span data-line="1217">    <span class="k">def</span><span class="w"> </span><span class="nf">capture_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">):</span>
</span><span data-line="1218">        <span class="c1"># type: (str, Optional[LogLevelStr], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span data-line="1219"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1220"><span class="sd">        Captures a message.</span>
</span><span data-line="1221">
</span><span data-line="1222"><span class="sd">        :param message: The string to send as the message.</span>
</span><span data-line="1223">
</span><span data-line="1224"><span class="sd">        :param level: If no level is provided, the default level is `info`.</span>
</span><span data-line="1225">
</span><span data-line="1226"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span data-line="1227"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span data-line="1228">
</span><span data-line="1229"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span data-line="1230"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span data-line="1231"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span data-line="1232">
</span><span data-line="1233"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.client._Client.capture_event`).</span>
</span><span data-line="1234"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1235">        <span class="k">if</span> <span class="n">disable_capture_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
</span><span data-line="1236">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1237">
</span><span data-line="1238">        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1239">            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>
</span><span data-line="1240">
</span><span data-line="1241">        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="1242">            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span data-line="1243">            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
</span><span data-line="1244">        <span class="p">}</span>  <span class="c1"># type: Event</span>
</span><span data-line="1245">
</span><span data-line="1246">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">)</span></div>

</span><span data-line="1247">
<div class="viewcode-block" id="Scope.capture_exception">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.capture_exception">[docs]</a>
</span><span data-line="1248">    <span class="k">def</span><span class="w"> </span><span class="nf">capture_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">):</span>
</span><span data-line="1249">        <span class="c1"># type: (Optional[Union[BaseException, ExcInfo]], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span data-line="1250"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Captures an exception.</span>
</span><span data-line="1251">
</span><span data-line="1252"><span class="sd">        :param error: An exception to capture. If `None`, `sys.exc_info()` will be used.</span>
</span><span data-line="1253">
</span><span data-line="1254"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span data-line="1255"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span data-line="1256">
</span><span data-line="1257"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span data-line="1258"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span data-line="1259"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span data-line="1260">
</span><span data-line="1261"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.client._Client.capture_event`).</span>
</span><span data-line="1262"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1263">        <span class="k">if</span> <span class="n">disable_capture_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
</span><span data-line="1264">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1265">
</span><span data-line="1266">        <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1267">            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">exc_info_from_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span data-line="1268">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1269">            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span data-line="1270">
</span><span data-line="1271">        <span class="n">event</span><span class="p">,</span> <span class="n">hint</span> <span class="o">=</span> <span class="n">event_from_exception</span><span class="p">(</span>
</span><span data-line="1272">            <span class="n">exc_info</span><span class="p">,</span> <span class="n">client_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">options</span>
</span><span data-line="1273">        <span class="p">)</span>
</span><span data-line="1274">
</span><span data-line="1275">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1276">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">)</span>
</span><span data-line="1277">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span data-line="1278">            <span class="n">capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
</span><span data-line="1279">
</span><span data-line="1280">        <span class="k">return</span> <span class="kc">None</span></div>

</span><span data-line="1281">
<div class="viewcode-block" id="Scope.start_session">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.start_session">[docs]</a>
</span><span data-line="1282">    <span class="k">def</span><span class="w"> </span><span class="nf">start_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="1283">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span data-line="1284"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts a new session.&quot;&quot;&quot;</span>
</span><span data-line="1285">        <span class="n">session_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;session_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;application&quot;</span><span class="p">)</span>
</span><span data-line="1286">
</span><span data-line="1287">        <span class="bp">self</span><span class="o">.</span><span class="n">end_session</span><span class="p">()</span>
</span><span data-line="1288">
</span><span data-line="1289">        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span data-line="1290">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span>
</span><span data-line="1291">            <span class="n">release</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;release&quot;</span><span class="p">),</span>
</span><span data-line="1292">            <span class="n">environment</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">),</span>
</span><span data-line="1293">            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">,</span>
</span><span data-line="1294">            <span class="n">session_mode</span><span class="o">=</span><span class="n">session_mode</span><span class="p">,</span>
</span><span data-line="1295">        <span class="p">)</span></div>

</span><span data-line="1296">
<div class="viewcode-block" id="Scope.end_session">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.end_session">[docs]</a>
</span><span data-line="1297">    <span class="k">def</span><span class="w"> </span><span class="nf">end_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="1298">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span data-line="1299"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ends the current session if there is one.&quot;&quot;&quot;</span>
</span><span data-line="1300">        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
</span><span data-line="1301">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1302">
</span><span data-line="1303">        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1304">            <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span data-line="1305">            <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">capture_session</span><span class="p">(</span><span class="n">session</span><span class="p">)</span></div>

</span><span data-line="1306">
<div class="viewcode-block" id="Scope.stop_auto_session_tracking">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.stop_auto_session_tracking">[docs]</a>
</span><span data-line="1307">    <span class="k">def</span><span class="w"> </span><span class="nf">stop_auto_session_tracking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span data-line="1308">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span data-line="1309"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops automatic session tracking.</span>
</span><span data-line="1310">
</span><span data-line="1311"><span class="sd">        This temporarily session tracking for the current scope when called.</span>
</span><span data-line="1312"><span class="sd">        To resume session tracking call `resume_auto_session_tracking`.</span>
</span><span data-line="1313"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1314">        <span class="bp">self</span><span class="o">.</span><span class="n">end_session</span><span class="p">()</span>
</span><span data-line="1315">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">False</span></div>

</span><span data-line="1316">
<div class="viewcode-block" id="Scope.resume_auto_session_tracking">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.resume_auto_session_tracking">[docs]</a>
</span><span data-line="1317">    <span class="k">def</span><span class="w"> </span><span class="nf">resume_auto_session_tracking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1318">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="1319"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resumes automatic session tracking for the current scope if</span>
</span><span data-line="1320"><span class="sd">        disabled earlier.  This requires that generally automatic session</span>
</span><span data-line="1321"><span class="sd">        tracking is enabled.</span>
</span><span data-line="1322"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1323">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">None</span></div>

</span><span data-line="1324">
<div class="viewcode-block" id="Scope.add_event_processor">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.add_event_processor">[docs]</a>
</span><span data-line="1325">    <span class="k">def</span><span class="w"> </span><span class="nf">add_event_processor</span><span class="p">(</span>
</span><span data-line="1326">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1327">        <span class="n">func</span><span class="p">,</span>  <span class="c1"># type: EventProcessor</span>
</span><span data-line="1328">    <span class="p">):</span>
</span><span data-line="1329">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="1330"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a scope local event processor on the scope.</span>
</span><span data-line="1331">
</span><span data-line="1332"><span class="sd">        :param func: This function behaves like `before_send.`</span>
</span><span data-line="1333"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1334">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span data-line="1335">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="1336">                <span class="s2">&quot;Too many event processors on scope! Clearing list to free up some memory: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="1337">                <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">,</span>
</span><span data-line="1338">            <span class="p">)</span>
</span><span data-line="1339">            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">[:]</span>
</span><span data-line="1340">
</span><span data-line="1341">        <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

</span><span data-line="1342">
<div class="viewcode-block" id="Scope.add_error_processor">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.add_error_processor">[docs]</a>
</span><span data-line="1343">    <span class="k">def</span><span class="w"> </span><span class="nf">add_error_processor</span><span class="p">(</span>
</span><span data-line="1344">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1345">        <span class="n">func</span><span class="p">,</span>  <span class="c1"># type: ErrorProcessor</span>
</span><span data-line="1346">        <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Type[BaseException]]</span>
</span><span data-line="1347">    <span class="p">):</span>
</span><span data-line="1348">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="1349"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a scope local error processor on the scope.</span>
</span><span data-line="1350">
</span><span data-line="1351"><span class="sd">        :param func: A callback that works similar to an event processor but is invoked with the original exception info triple as second argument.</span>
</span><span data-line="1352">
</span><span data-line="1353"><span class="sd">        :param cls: Optionally, only process exceptions of this type.</span>
</span><span data-line="1354"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1355">        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1356">            <span class="n">cls_</span> <span class="o">=</span> <span class="bp">cls</span>  <span class="c1"># For mypy.</span>
</span><span data-line="1357">            <span class="n">real_func</span> <span class="o">=</span> <span class="n">func</span>
</span><span data-line="1358">
</span><span data-line="1359">            <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">):</span>
</span><span data-line="1360">                <span class="c1"># type: (Event, ExcInfo) -&gt; Optional[Event]</span>
</span><span data-line="1361">                <span class="k">try</span><span class="p">:</span>
</span><span data-line="1362">                    <span class="n">is_inst</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cls_</span><span class="p">)</span>
</span><span data-line="1363">                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span data-line="1364">                    <span class="n">is_inst</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="1365">                <span class="k">if</span> <span class="n">is_inst</span><span class="p">:</span>
</span><span data-line="1366">                    <span class="k">return</span> <span class="n">real_func</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">)</span>
</span><span data-line="1367">                <span class="k">return</span> <span class="n">event</span>
</span><span data-line="1368">
</span><span data-line="1369">        <span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

</span><span data-line="1370">
</span><span data-line="1371">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_level_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1372">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1373">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1374">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
</span><span data-line="1375">
</span><span data-line="1376">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_breadcrumbs_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1377">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1378">        <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span data-line="1379">
</span><span data-line="1380">        <span class="c1"># This check is just for mypy -</span>
</span><span data-line="1381">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">],</span> <span class="n">AnnotatedValue</span><span class="p">):</span>
</span><span data-line="1382">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span data-line="1383">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">][</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span>
</span><span data-line="1384">
</span><span data-line="1385">        <span class="c1"># Attempt to sort timestamps</span>
</span><span data-line="1386">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1387">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">],</span> <span class="n">AnnotatedValue</span><span class="p">):</span>
</span><span data-line="1388">                <span class="k">for</span> <span class="n">crumb</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">][</span><span class="s2">&quot;values&quot;</span><span class="p">]:</span>
</span><span data-line="1389">                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="1390">                        <span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime_from_isoformat</span><span class="p">(</span><span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span>
</span><span data-line="1391">
</span><span data-line="1392">                <span class="n">event</span><span class="p">[</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">][</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
</span><span data-line="1393">                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">crumb</span><span class="p">:</span> <span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
</span><span data-line="1394">                <span class="p">)</span>
</span><span data-line="1395">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span data-line="1396">            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error when sorting breadcrumbs&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">err</span><span class="p">)</span>
</span><span data-line="1397">            <span class="k">pass</span>
</span><span data-line="1398">
</span><span data-line="1399">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_user_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1400">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1401">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1402">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span>
</span><span data-line="1403">
</span><span data-line="1404">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_transaction_name_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1405">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1406">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transaction&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1407">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span>
</span><span data-line="1408">
</span><span data-line="1409">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_transaction_info_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1410">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1411">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transaction_info&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1412">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;transaction_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span>
</span><span data-line="1413">
</span><span data-line="1414">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_fingerprint_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1415">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1416">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1417">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span data-line="1418">
</span><span data-line="1419">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_extra_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1420">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1421">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">:</span>
</span><span data-line="1422">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;extra&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">)</span>
</span><span data-line="1423">
</span><span data-line="1424">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_tags_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1425">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1426">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">:</span>
</span><span data-line="1427">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
</span><span data-line="1428">
</span><span data-line="1429">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_contexts_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1430">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1431">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">:</span>
</span><span data-line="1432">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">)</span>
</span><span data-line="1433">
</span><span data-line="1434">        <span class="n">contexts</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span data-line="1435">
</span><span data-line="1436">        <span class="c1"># Add &quot;trace&quot; context</span>
</span><span data-line="1437">        <span class="k">if</span> <span class="n">contexts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trace&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1438">            <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1439">                <span class="n">contexts</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">get_trace_context</span><span class="p">()</span>
</span><span data-line="1440">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1441">                <span class="n">contexts</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace_context</span><span class="p">()</span>
</span><span data-line="1442">
</span><span data-line="1443">    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_flags_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span data-line="1444">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span data-line="1445">        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="1446">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="1447">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;flags&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span data-line="1448">                <span class="p">{</span><span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="n">flags</span><span class="p">}</span>
</span><span data-line="1449">            <span class="p">)</span>
</span><span data-line="1450">
</span><span data-line="1451">    <span class="k">def</span><span class="w"> </span><span class="nf">_drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cause</span><span class="p">,</span> <span class="n">ty</span><span class="p">):</span>
</span><span data-line="1452">        <span class="c1"># type: (Any, str) -&gt; Optional[Any]</span>
</span><span data-line="1453">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) dropped event&quot;</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">cause</span><span class="p">)</span>
</span><span data-line="1454">        <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1455">
<div class="viewcode-block" id="Scope.run_error_processors">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.run_error_processors">[docs]</a>
</span><span data-line="1456">    <span class="k">def</span><span class="w"> </span><span class="nf">run_error_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">):</span>
</span><span data-line="1457">        <span class="c1"># type: (Event, Hint) -&gt; Optional[Event]</span>
</span><span data-line="1458"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1459"><span class="sd">        Runs the error processors on the event and returns the modified event.</span>
</span><span data-line="1460"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1461">        <span class="n">exc_info</span> <span class="o">=</span> <span class="n">hint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exc_info&quot;</span><span class="p">)</span>
</span><span data-line="1462">        <span class="k">if</span> <span class="n">exc_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1463">            <span class="n">error_processors</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span>
</span><span data-line="1464">                <span class="bp">self</span><span class="o">.</span><span class="n">get_global_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">,</span>
</span><span data-line="1465">                <span class="bp">self</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">,</span>
</span><span data-line="1466">                <span class="bp">self</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">,</span>
</span><span data-line="1467">            <span class="p">)</span>
</span><span data-line="1468">
</span><span data-line="1469">            <span class="k">for</span> <span class="n">error_processor</span> <span class="ow">in</span> <span class="n">error_processors</span><span class="p">:</span>
</span><span data-line="1470">                <span class="n">new_event</span> <span class="o">=</span> <span class="n">error_processor</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">)</span>
</span><span data-line="1471">                <span class="k">if</span> <span class="n">new_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1472">                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drop</span><span class="p">(</span><span class="n">error_processor</span><span class="p">,</span> <span class="s2">&quot;error processor&quot;</span><span class="p">)</span>
</span><span data-line="1473">
</span><span data-line="1474">                <span class="n">event</span> <span class="o">=</span> <span class="n">new_event</span>
</span><span data-line="1475">
</span><span data-line="1476">        <span class="k">return</span> <span class="n">event</span></div>

</span><span data-line="1477">
<div class="viewcode-block" id="Scope.run_event_processors">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.run_event_processors">[docs]</a>
</span><span data-line="1478">    <span class="k">def</span><span class="w"> </span><span class="nf">run_event_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">):</span>
</span><span data-line="1479">        <span class="c1"># type: (Event, Hint) -&gt; Optional[Event]</span>
</span><span data-line="1480"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1481"><span class="sd">        Runs the event processors on the event and returns the modified event.</span>
</span><span data-line="1482"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1483">        <span class="n">ty</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span data-line="1484">        <span class="n">is_check_in</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;check_in&quot;</span>
</span><span data-line="1485">
</span><span data-line="1486">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span data-line="1487">            <span class="c1"># Get scopes without creating them to prevent infinite recursion</span>
</span><span data-line="1488">            <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="1489">            <span class="n">current_scope</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="1490">
</span><span data-line="1491">            <span class="n">event_processors</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span>
</span><span data-line="1492">                <span class="n">global_event_processors</span><span class="p">,</span>
</span><span data-line="1493">                <span class="n">_global_scope</span> <span class="ow">and</span> <span class="n">_global_scope</span><span class="o">.</span><span class="n">_event_processors</span> <span class="ow">or</span> <span class="p">[],</span>
</span><span data-line="1494">                <span class="n">isolation_scope</span> <span class="ow">and</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">_event_processors</span> <span class="ow">or</span> <span class="p">[],</span>
</span><span data-line="1495">                <span class="n">current_scope</span> <span class="ow">and</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">_event_processors</span> <span class="ow">or</span> <span class="p">[],</span>
</span><span data-line="1496">            <span class="p">)</span>
</span><span data-line="1497">
</span><span data-line="1498">            <span class="k">for</span> <span class="n">event_processor</span> <span class="ow">in</span> <span class="n">event_processors</span><span class="p">:</span>
</span><span data-line="1499">                <span class="n">new_event</span> <span class="o">=</span> <span class="n">event</span>
</span><span data-line="1500">                <span class="k">with</span> <span class="n">capture_internal_exceptions</span><span class="p">():</span>
</span><span data-line="1501">                    <span class="n">new_event</span> <span class="o">=</span> <span class="n">event_processor</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span data-line="1502">                <span class="k">if</span> <span class="n">new_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1503">                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drop</span><span class="p">(</span><span class="n">event_processor</span><span class="p">,</span> <span class="s2">&quot;event processor&quot;</span><span class="p">)</span>
</span><span data-line="1504">                <span class="n">event</span> <span class="o">=</span> <span class="n">new_event</span>
</span><span data-line="1505">
</span><span data-line="1506">        <span class="k">return</span> <span class="n">event</span></div>

</span><span data-line="1507">
<div class="viewcode-block" id="Scope.apply_to_event">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.apply_to_event">[docs]</a>
</span><span data-line="1508">    <span class="nd">@_disable_capture</span>
</span><span data-line="1509">    <span class="k">def</span><span class="w"> </span><span class="nf">apply_to_event</span><span class="p">(</span>
</span><span data-line="1510">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1511">        <span class="n">event</span><span class="p">,</span>  <span class="c1"># type: Event</span>
</span><span data-line="1512">        <span class="n">hint</span><span class="p">,</span>  <span class="c1"># type: Hint</span>
</span><span data-line="1513">        <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span data-line="1514">    <span class="p">):</span>
</span><span data-line="1515">        <span class="c1"># type: (...) -&gt; Optional[Event]</span>
</span><span data-line="1516"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies the information contained on the scope to the given event.&quot;&quot;&quot;</span>
</span><span data-line="1517">        <span class="n">ty</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span data-line="1518">        <span class="n">is_transaction</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;transaction&quot;</span>
</span><span data-line="1519">        <span class="n">is_check_in</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;check_in&quot;</span>
</span><span data-line="1520">
</span><span data-line="1521">        <span class="c1"># put all attachments into the hint. This lets callbacks play around</span>
</span><span data-line="1522">        <span class="c1"># with attachments. We also later pull this out of the hint when we</span>
</span><span data-line="1523">        <span class="c1"># create the envelope.</span>
</span><span data-line="1524">        <span class="n">attachments_to_send</span> <span class="o">=</span> <span class="n">hint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attachments&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="1525">        <span class="k">for</span> <span class="n">attachment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="p">:</span>
</span><span data-line="1526">            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_transaction</span> <span class="ow">or</span> <span class="n">attachment</span><span class="o">.</span><span class="n">add_to_transactions</span><span class="p">:</span>
</span><span data-line="1527">                <span class="n">attachments_to_send</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attachment</span><span class="p">)</span>
</span><span data-line="1528">        <span class="n">hint</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attachments_to_send</span>
</span><span data-line="1529">
</span><span data-line="1530">        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_contexts_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1531">
</span><span data-line="1532">        <span class="k">if</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span data-line="1533">            <span class="c1"># Check-ins only support the trace context, strip all others</span>
</span><span data-line="1534">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;contexts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="1535">                <span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trace&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span data-line="1536">            <span class="p">}</span>
</span><span data-line="1537">
</span><span data-line="1538">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span data-line="1539">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_level_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1540">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_fingerprint_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1541">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_user_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1542">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transaction_name_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1543">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transaction_info_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1544">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_tags_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1545">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_extra_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1546">
</span><span data-line="1547">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_transaction</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span data-line="1548">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_breadcrumbs_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1549">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_flags_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span data-line="1550">
</span><span data-line="1551">        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_error_processors</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span data-line="1552">        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1553">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1554">
</span><span data-line="1555">        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_event_processors</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span data-line="1556">        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1557">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1558">
</span><span data-line="1559">        <span class="k">return</span> <span class="n">event</span></div>

</span><span data-line="1560">
<div class="viewcode-block" id="Scope.update_from_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.update_from_scope">[docs]</a>
</span><span data-line="1561">    <span class="k">def</span><span class="w"> </span><span class="nf">update_from_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
</span><span data-line="1562">        <span class="c1"># type: (Scope) -&gt; None</span>
</span><span data-line="1563"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the scope with another scope&#39;s data.&quot;&quot;&quot;</span>
</span><span data-line="1564">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1565">            <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_level</span>
</span><span data-line="1566">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1567">            <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span data-line="1568">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1569">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction</span>
</span><span data-line="1570">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1571">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">)</span>
</span><span data-line="1572">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1573">            <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_user</span>
</span><span data-line="1574">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_tags</span><span class="p">:</span>
</span><span data-line="1575">            <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
</span><span data-line="1576">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_contexts</span><span class="p">:</span>
</span><span data-line="1577">            <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_contexts</span><span class="p">)</span>
</span><span data-line="1578">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_extras</span><span class="p">:</span>
</span><span data-line="1579">            <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_extras</span><span class="p">)</span>
</span><span data-line="1580">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">:</span>
</span><span data-line="1581">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span>
</span><span data-line="1582">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span><span class="p">:</span>
</span><span data-line="1583">            <span class="bp">self</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1584">                <span class="bp">self</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span> <span class="o">+</span> <span class="n">scope</span><span class="o">.</span><span class="n">_n_breadcrumbs_truncated</span>
</span><span data-line="1585">            <span class="p">)</span>
</span><span data-line="1586">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_span</span><span class="p">:</span>
</span><span data-line="1587">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_span</span>
</span><span data-line="1588">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_attachments</span><span class="p">:</span>
</span><span data-line="1589">            <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_attachments</span><span class="p">)</span>
</span><span data-line="1590">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_profile</span><span class="p">:</span>
</span><span data-line="1591">            <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_profile</span>
</span><span data-line="1592">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">:</span>
</span><span data-line="1593">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span data-line="1594">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_session</span><span class="p">:</span>
</span><span data-line="1595">            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_session</span>
</span><span data-line="1596">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_flags</span><span class="p">:</span>
</span><span data-line="1597">            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">:</span>
</span><span data-line="1598">                <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
</span><span data-line="1599">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1600">                <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
</span><span data-line="1601">                    <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="s2">&quot;flag&quot;</span><span class="p">],</span> <span class="n">flag</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">])</span></div>

</span><span data-line="1602">
<div class="viewcode-block" id="Scope.update_from_kwargs">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.update_from_kwargs">[docs]</a>
</span><span data-line="1603">    <span class="k">def</span><span class="w"> </span><span class="nf">update_from_kwargs</span><span class="p">(</span>
</span><span data-line="1604">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1605">        <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Any]</span>
</span><span data-line="1606">        <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[LogLevelStr]</span>
</span><span data-line="1607">        <span class="n">extras</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span data-line="1608">        <span class="n">contexts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Dict[str, Any]]]</span>
</span><span data-line="1609">        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, str]]</span>
</span><span data-line="1610">        <span class="n">fingerprint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[List[str]]</span>
</span><span data-line="1611">    <span class="p">):</span>
</span><span data-line="1612">        <span class="c1"># type: (...) -&gt; None</span>
</span><span data-line="1613"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the scope&#39;s attributes.&quot;&quot;&quot;</span>
</span><span data-line="1614">        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1615">            <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
</span><span data-line="1616">        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1617">            <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>
</span><span data-line="1618">        <span class="k">if</span> <span class="n">extras</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1619">            <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>
</span><span data-line="1620">        <span class="k">if</span> <span class="n">contexts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1621">            <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contexts</span><span class="p">)</span>
</span><span data-line="1622">        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1623">            <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</span><span data-line="1624">        <span class="k">if</span> <span class="n">fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1625">            <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">fingerprint</span></div>

</span><span data-line="1626">
</span><span data-line="1627">    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1628">        <span class="c1"># type: () -&gt; str</span>
</span><span data-line="1629">        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> id=</span><span class="si">%s</span><span class="s2"> name=</span><span class="si">%s</span><span class="s2"> type=</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span data-line="1630">            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span data-line="1631">            <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
</span><span data-line="1632">            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
</span><span data-line="1633">            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">,</span>
</span><span data-line="1634">        <span class="p">)</span>
</span><span data-line="1635">
</span><span data-line="1636">    <span class="nd">@property</span>
</span><span data-line="1637">    <span class="k">def</span><span class="w"> </span><span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1638">        <span class="c1"># type: () -&gt; FlagBuffer</span>
</span><span data-line="1639">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1640">            <span class="n">max_flags</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1641">                <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;_experiments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_flags&quot;</span><span class="p">)</span>
</span><span data-line="1642">                <span class="ow">or</span> <span class="n">DEFAULT_FLAG_CAPACITY</span>
</span><span data-line="1643">            <span class="p">)</span>
</span><span data-line="1644">            <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">FlagBuffer</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">max_flags</span><span class="p">)</span>
</span><span data-line="1645">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span></div>

</span><span data-line="1646">
</span><span data-line="1647">
<div class="viewcode-block" id="new_scope">
<a class="viewcode-back" href="../../api.html#sentry_sdk.api.new_scope">[docs]</a>
</span><span data-line="1648"><span class="nd">@contextmanager</span>
</span><span data-line="1649"><span class="k">def</span><span class="w"> </span><span class="nf">new_scope</span><span class="p">():</span>
</span><span data-line="1650">    <span class="c1"># type: () -&gt; Generator[Scope, None, None]</span>
</span><span data-line="1651"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1652"><span class="sd">    .. versionadded:: 2.0.0</span>
</span><span data-line="1653">
</span><span data-line="1654"><span class="sd">    Context manager that forks the current scope and runs the wrapped code in it.</span>
</span><span data-line="1655"><span class="sd">    After the wrapped code is executed, the original scope is restored.</span>
</span><span data-line="1656">
</span><span data-line="1657"><span class="sd">    Example Usage:</span>
</span><span data-line="1658">
</span><span data-line="1659"><span class="sd">    .. code-block:: python</span>
</span><span data-line="1660">
</span><span data-line="1661"><span class="sd">        import sentry_sdk</span>
</span><span data-line="1662">
</span><span data-line="1663"><span class="sd">        with sentry_sdk.new_scope() as scope:</span>
</span><span data-line="1664"><span class="sd">            scope.set_tag(&quot;color&quot;, &quot;green&quot;)</span>
</span><span data-line="1665"><span class="sd">            sentry_sdk.capture_message(&quot;hello&quot;) # will include `color` tag.</span>
</span><span data-line="1666">
</span><span data-line="1667"><span class="sd">        sentry_sdk.capture_message(&quot;hello, again&quot;) # will NOT include `color` tag.</span>
</span><span data-line="1668">
</span><span data-line="1669"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="1670">    <span class="c1"># fork current scope</span>
</span><span data-line="1671">    <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span data-line="1672">    <span class="n">new_scope</span> <span class="o">=</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span data-line="1673">    <span class="n">token</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_scope</span><span class="p">)</span>
</span><span data-line="1674">
</span><span data-line="1675">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="1676">        <span class="k">yield</span> <span class="n">new_scope</span>
</span><span data-line="1677">
</span><span data-line="1678">    <span class="k">finally</span><span class="p">:</span>
</span><span data-line="1679">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1680">            <span class="c1"># restore original scope</span>
</span><span data-line="1681">            <span class="n">_current_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span data-line="1682">        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span data-line="1683">            <span class="n">capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span></div>

</span><span data-line="1684">
</span><span data-line="1685">
</span><span data-line="1686"><span class="nd">@contextmanager</span>
</span><span data-line="1687"><span class="k">def</span><span class="w"> </span><span class="nf">use_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
</span><span data-line="1688">    <span class="c1"># type: (Scope) -&gt; Generator[Scope, None, None]</span>
</span><span data-line="1689"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1690"><span class="sd">    .. versionadded:: 2.0.0</span>
</span><span data-line="1691">
</span><span data-line="1692"><span class="sd">    Context manager that uses the given `scope` and runs the wrapped code in it.</span>
</span><span data-line="1693"><span class="sd">    After the wrapped code is executed, the original scope is restored.</span>
</span><span data-line="1694">
</span><span data-line="1695"><span class="sd">    Example Usage:</span>
</span><span data-line="1696"><span class="sd">    Suppose the variable `scope` contains a `Scope` object, which is not currently</span>
</span><span data-line="1697"><span class="sd">    the active scope.</span>
</span><span data-line="1698">
</span><span data-line="1699"><span class="sd">    .. code-block:: python</span>
</span><span data-line="1700">
</span><span data-line="1701"><span class="sd">        import sentry_sdk</span>
</span><span data-line="1702">
</span><span data-line="1703"><span class="sd">        with sentry_sdk.use_scope(scope):</span>
</span><span data-line="1704"><span class="sd">            scope.set_tag(&quot;color&quot;, &quot;green&quot;)</span>
</span><span data-line="1705"><span class="sd">            sentry_sdk.capture_message(&quot;hello&quot;) # will include `color` tag.</span>
</span><span data-line="1706">
</span><span data-line="1707"><span class="sd">        sentry_sdk.capture_message(&quot;hello, again&quot;) # will NOT include `color` tag.</span>
</span><span data-line="1708">
</span><span data-line="1709"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="1710">    <span class="c1"># set given scope as current scope</span>
</span><span data-line="1711">    <span class="n">token</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
</span><span data-line="1712">
</span><span data-line="1713">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="1714">        <span class="k">yield</span> <span class="n">scope</span>
</span><span data-line="1715">
</span><span data-line="1716">    <span class="k">finally</span><span class="p">:</span>
</span><span data-line="1717">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1718">            <span class="c1"># restore original scope</span>
</span><span data-line="1719">            <span class="n">_current_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span data-line="1720">        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span data-line="1721">            <span class="n">capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
</span><span data-line="1722">
</span><span data-line="1723">
</span><span data-line="1724"><span class="nd">@contextmanager</span>
</span><span data-line="1725"><span class="k">def</span><span class="w"> </span><span class="nf">isolation_scope</span><span class="p">():</span>
</span><span data-line="1726">    <span class="c1"># type: () -&gt; Generator[Scope, None, None]</span>
</span><span data-line="1727"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1728"><span class="sd">    .. versionadded:: 2.0.0</span>
</span><span data-line="1729">
</span><span data-line="1730"><span class="sd">    Context manager that forks the current isolation scope and runs the wrapped code in it.</span>
</span><span data-line="1731"><span class="sd">    The current scope is also forked to not bleed data into the existing current scope.</span>
</span><span data-line="1732"><span class="sd">    After the wrapped code is executed, the original scopes are restored.</span>
</span><span data-line="1733">
</span><span data-line="1734"><span class="sd">    Example Usage:</span>
</span><span data-line="1735">
</span><span data-line="1736"><span class="sd">    .. code-block:: python</span>
</span><span data-line="1737">
</span><span data-line="1738"><span class="sd">        import sentry_sdk</span>
</span><span data-line="1739">
</span><span data-line="1740"><span class="sd">        with sentry_sdk.isolation_scope() as scope:</span>
</span><span data-line="1741"><span class="sd">            scope.set_tag(&quot;color&quot;, &quot;green&quot;)</span>
</span><span data-line="1742"><span class="sd">            sentry_sdk.capture_message(&quot;hello&quot;) # will include `color` tag.</span>
</span><span data-line="1743">
</span><span data-line="1744"><span class="sd">        sentry_sdk.capture_message(&quot;hello, again&quot;) # will NOT include `color` tag.</span>
</span><span data-line="1745">
</span><span data-line="1746"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="1747">    <span class="c1"># fork current scope</span>
</span><span data-line="1748">    <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span data-line="1749">    <span class="n">forked_current_scope</span> <span class="o">=</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span data-line="1750">    <span class="n">current_token</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">forked_current_scope</span><span class="p">)</span>
</span><span data-line="1751">
</span><span data-line="1752">    <span class="c1"># fork isolation scope</span>
</span><span data-line="1753">    <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span>
</span><span data-line="1754">    <span class="n">new_isolation_scope</span> <span class="o">=</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span data-line="1755">    <span class="n">isolation_token</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_isolation_scope</span><span class="p">)</span>
</span><span data-line="1756">
</span><span data-line="1757">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="1758">        <span class="k">yield</span> <span class="n">new_isolation_scope</span>
</span><span data-line="1759">
</span><span data-line="1760">    <span class="k">finally</span><span class="p">:</span>
</span><span data-line="1761">        <span class="c1"># restore original scopes</span>
</span><span data-line="1762">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1763">            <span class="n">_current_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">current_token</span><span class="p">)</span>
</span><span data-line="1764">        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span data-line="1765">            <span class="n">capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
</span><span data-line="1766">
</span><span data-line="1767">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1768">            <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">isolation_token</span><span class="p">)</span>
</span><span data-line="1769">        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span data-line="1770">            <span class="n">capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
</span><span data-line="1771">
</span><span data-line="1772">
</span><span data-line="1773"><span class="nd">@contextmanager</span>
</span><span data-line="1774"><span class="k">def</span><span class="w"> </span><span class="nf">use_isolation_scope</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">):</span>
</span><span data-line="1775">    <span class="c1"># type: (Scope) -&gt; Generator[Scope, None, None]</span>
</span><span data-line="1776"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1777"><span class="sd">    .. versionadded:: 2.0.0</span>
</span><span data-line="1778">
</span><span data-line="1779"><span class="sd">    Context manager that uses the given `isolation_scope` and runs the wrapped code in it.</span>
</span><span data-line="1780"><span class="sd">    The current scope is also forked to not bleed data into the existing current scope.</span>
</span><span data-line="1781"><span class="sd">    After the wrapped code is executed, the original scopes are restored.</span>
</span><span data-line="1782">
</span><span data-line="1783"><span class="sd">    Example Usage:</span>
</span><span data-line="1784">
</span><span data-line="1785"><span class="sd">    .. code-block:: python</span>
</span><span data-line="1786">
</span><span data-line="1787"><span class="sd">        import sentry_sdk</span>
</span><span data-line="1788">
</span><span data-line="1789"><span class="sd">        with sentry_sdk.isolation_scope() as scope:</span>
</span><span data-line="1790"><span class="sd">            scope.set_tag(&quot;color&quot;, &quot;green&quot;)</span>
</span><span data-line="1791"><span class="sd">            sentry_sdk.capture_message(&quot;hello&quot;) # will include `color` tag.</span>
</span><span data-line="1792">
</span><span data-line="1793"><span class="sd">        sentry_sdk.capture_message(&quot;hello, again&quot;) # will NOT include `color` tag.</span>
</span><span data-line="1794">
</span><span data-line="1795"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="1796">    <span class="c1"># fork current scope</span>
</span><span data-line="1797">    <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span data-line="1798">    <span class="n">forked_current_scope</span> <span class="o">=</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span data-line="1799">    <span class="n">current_token</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">forked_current_scope</span><span class="p">)</span>
</span><span data-line="1800">
</span><span data-line="1801">    <span class="c1"># set given scope as isolation scope</span>
</span><span data-line="1802">    <span class="n">isolation_token</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">)</span>
</span><span data-line="1803">
</span><span data-line="1804">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="1805">        <span class="k">yield</span> <span class="n">isolation_scope</span>
</span><span data-line="1806">
</span><span data-line="1807">    <span class="k">finally</span><span class="p">:</span>
</span><span data-line="1808">        <span class="c1"># restore original scopes</span>
</span><span data-line="1809">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1810">            <span class="n">_current_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">current_token</span><span class="p">)</span>
</span><span data-line="1811">        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span data-line="1812">            <span class="n">capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
</span><span data-line="1813">
</span><span data-line="1814">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1815">            <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">isolation_token</span><span class="p">)</span>
</span><span data-line="1816">        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span data-line="1817">            <span class="n">capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
</span><span data-line="1818">
</span><span data-line="1819">
</span><span data-line="1820"><span class="k">def</span><span class="w"> </span><span class="nf">should_send_default_pii</span><span class="p">():</span>
</span><span data-line="1821">    <span class="c1"># type: () -&gt; bool</span>
</span><span data-line="1822"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Shortcut for `Scope.get_client().should_send_default_pii()`.&quot;&quot;&quot;</span>
</span><span data-line="1823">    <span class="k">return</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">should_send_default_pii</span><span class="p">()</span>
</span><span data-line="1824">
</span><span data-line="1825">
</span><span data-line="1826"><span class="c1"># Circular imports</span>
</span><span data-line="1827"><span class="kn">from</span><span class="w"> </span><span class="nn">sentry_sdk.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">NonRecordingClient</span>
</span><span data-line="1828">
</span><span data-line="1829"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="1830">    <span class="kn">import</span><span class="w"> </span><span class="nn">sentry_sdk.client</span>
</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2019-2025, Sentry Team and Contributors</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/getsentry/sentry-python" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=3e4cc644"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/shibuya.js?v=e730760c"></script></body>
</html>